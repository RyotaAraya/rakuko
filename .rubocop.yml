AllCops:
  NewCops: enable
  TargetRubyVersion: 3.2
  Exclude:
    - 'vendor/**/*'
    - 'db/schema.rb'
    - 'node_modules/**/*'
    - 'bin/**/*'
    - 'config/boot.rb'
    - 'config/environment.rb'
    - 'config/application.rb'
    - 'config/environments/**/*'
    - 'Rakefile'

plugins:
  - rubocop-rails

# Line length
Layout/LineLength:
  Max: 120
  Exclude:
    - 'config/initializers/**/*'     # 設定ファイルは長い行が許容される

# String literals - prefer single quotes
Style/StringLiterals:
  EnforcedStyle: single_quotes

# Allow long blocks in specs and routes
Metrics/BlockLength:
  Exclude:
    - 'spec/**/*'
    - 'config/routes.rb'
    - 'db/seeds.rb'

# Allow longer methods in migrations and business logic
Metrics/MethodLength:
  Exclude:
    - 'db/migrate/**/*'
    - 'app/models/user.rb'            # OAuth処理
    - 'app/models/notification.rb'    # 通知作成メソッド群
    - 'app/models/month_end_closing.rb' # 月末締め処理
    - 'app/models/time_record.rb'     # 打刻順序バリデーション
    - 'app/controllers/admin/users_controller.rb'  # 管理画面ロジック

# Allow longer classes in controllers and complex models
Metrics/ClassLength:
  Exclude:
    - 'app/controllers/**/*'
    - 'app/models/user.rb'            # 権限管理とDevise統合で必然的に大きくなる
    - 'app/models/application.rb'     # 申請タイプ別バリデーション
    - 'app/models/approval.rb'        # ポリモーフィック承認システム
    - 'app/models/notification.rb'    # 通知システム
    - 'app/models/month_end_closing.rb' # 月末締め処理

# Documentation is not required for all classes
Style/Documentation:
  Enabled: false

# Allow trailing commas in multi-line arrays and hashes
Style/TrailingCommaInArrayLiteral:
  EnforcedStyleForMultiline: comma

Style/TrailingCommaInHashLiteral:
  EnforcedStyleForMultiline: comma

# Prefer symbols array syntax
Style/SymbolArray:
  EnforcedStyle: brackets

# Rails specific configurations
Rails/UniqueValidationWithoutIndex:
  Enabled: false  # データベース設計段階で対応予定

Rails/I18nLocaleTexts:
  Enabled: false  # 現段階では国際化は不要

Rails/InverseOf:
  Exclude:
    - 'app/models/user.rb'  # 複雑な関連付けでinverse_ofが困難

# Complex business logic exceptions
Metrics/AbcSize:
  Exclude:
    - 'app/models/user.rb'            # OAuth処理
    - 'app/models/time_record.rb'     # 打刻順序バリデーション
    - 'app/models/application.rb'     # タイプ別バリデーション
    - 'app/controllers/users/omniauth_callbacks_controller.rb'  # OAuth認証ロジック

Metrics/CyclomaticComplexity:
  Exclude:
    - 'app/models/time_record.rb'     # 打刻順序バリデーション

Metrics/PerceivedComplexity:
  Exclude:
    - 'app/models/time_record.rb'     # 打刻順序バリデーション

# Allow predicate method names for business logic
Naming/PredicateMethod:
  Exclude:
    - 'app/models/month_end_closing.rb'  # close_, lock_, reopen_メソッド群

Naming/PredicatePrefix:
  Exclude:
    - 'app/models/user.rb'  # has_role?はDeviseパターン

# Rails patterns
Rails/WhereNotWithMultipleConditions:
  Enabled: false  # 複数条件のwhere.notは意図的

Rails/SkipsModelValidations:
  Exclude:
    - 'app/models/notification.rb'    # 一括既読更新

# Migration specific rules
Rails/BulkChangeTable:
  Enabled: false  # マイグレーションは段階的に作成されるため

Rails/ThreeStateBooleanColumn:
  Enabled: false  # 既存のデータベース設計に合わせる

