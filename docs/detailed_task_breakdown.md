# 学生アルバイト勤怠管理システム「楽工」詳細タスク分解

タスク実装前に下記を必ず参照してから、タスクに取り掛かること
- 仕様書はREADME.mdを確認して
- er図はer_diagram.mdを参照すること
- designはdesignディレクトリ配下のhtmlファイルを参照すること

## Phase 1: 基盤構築

### 1-1. Docker環境構築 + Rails新規プロジェクト作成 - 3SP

**概要**: Docker開発環境を構築し、その中で学生アルバイト勤怠管理システムのRailsプロジェクトを新規作成

**詳細タスク**:
- [x] Docker環境構築
  - [x] Dockerfile作成（Ruby 3.2 + Node.js環境）
  - [x] docker-compose.yml作成（PostgreSQL、Redis含む）
  - [x] 開発環境用の環境変数設定
- [x] Docker内でRailsプロジェクト作成
  - [x] `rails new rakuko --database=postgresql` でプロジェクト作成
  - [x] database.yml設定（Docker環境用）
- [x] 基本gem導入
  - [x] devise gem（ユーザー認証）
  - [x] omniauth-google-oauth2 gem（Google OAuth）
  - [x] pundit gem（権限管理）
  - [x] aasm gem（状態管理）
  - [x] sidekiq gem（バックグラウンドジョブ）
- [x] Gemfile設定・初期セットアップ
  - [x] bundler設定
  - [x] 開発・テスト環境gem追加
  - [x] 初期コミット・GitHubプッシュ

**完了条件**:
- Dockerコンテナ内でRailsアプリケーションが正常に起動する
- 全ての基本gemが正しく導入されている
- GitHubリポジトリに初期コードがプッシュされている
- PostgreSQL、Redisとの接続が確認できている

---

### 1-2. Vue.js + TypeScript環境構築 - 2SP

**概要**: Vue.js 3 + TypeScriptの部分組み込み設定

**詳細タスク**:
- [x] Vue.js 3 + TypeScript部分組み込み設定
  - [x] vite_rails gem導入
  - [x] package.json設定
  - [x] TypeScript設定ファイル作成
  - [x] Vite設定ファイル作成
- [x] Vue.js環境確認
  - [x] Docker内でのVite + Rails連携確認
  - [x] 基本的なVue.jsコンポーネント作成テスト
  - [x] TypeScriptコンパイル確認

**完了条件**:
- Vue.js開発環境が機能している
- ViteによるHMRが動作している
- TypeScriptが正常にコンパイルされている

---

### 1-3. トップページ作成 - 2SP

**概要**: アプリケーションのランディングページを作成し、基本レイアウトとVue.jsの動作を確認

**詳細タスク**:
- [x] ランディングページ作成
  - [x] HomeController#index作成
  - [x] ルート設定（root to: 'home#index'）
  - [x] 基本的なトップページビュー作成
- [x] Vue.js部分組み込み
  - [x] Vue.jsコンポーネント作成（例: WelcomeMessage）
  - [x] Rails ViewとVue.jsの連携確認
  - [x] TypeScriptでの基本的な連携確認
- [x] 基本レイアウト・デザイン
  - [x] application.html.erb レイアウト作成
  - [x] ナビゲーションバー基本構造
  - [x] 基本CSS設定（Tailwind CSS + FOUC対策）
  - [x] フラッシュメッセージ表示機能
- [x] 初期ルーティング設定
  - [x] routes.rb基本設定

**完了条件**:
- トップページが正常に表示される
- Vue.jsコンポーネントが動作している
- 基本的なナビゲーションが機能している
- 基本的なレイアウトが適用されている

---

### 1-4. Render本番環境構築 - 2SP

**概要**: Render本番環境設定とPostgreSQLデータベース接続

**詳細タスク**:
- [ ] Render本番環境設定
  - [ ] Renderアカウント作成・設定
  - [ ] GitHubリポジトリ連携
  - [ ] 本番環境ビルド・デプロイ設定
- [ ] PostgreSQL接続設定
  - [ ] Render PostgreSQLサービス作成（本番）
  - [ ] database.yml本番環境設定
  - [ ] データベース接続テスト
- [ ] 環境変数設定・管理
  - [ ] SECRET_KEY_BASE設定（本番）
  - [ ] DATABASE_URL設定（本番）
  - [ ] Google OAuth設定（本番）
  - [ ] 環境変数管理シート作成

**完了条件**:
- Render本番環境へのデプロイが成功している
- 本番環境でアプリケーションが正常に動作している
- PostgreSQLデータベースに接続できている
- 環境設定が適切に分離されている

---

### 1-5. RenderSTG環境構築 - 1SP

**概要**: Renderステージング環境設定とSTG用PostgreSQLデータベース接続

**詳細タスク**:
- [ ] RenderSTG環境設定
  - [ ] STG環境ビルド・デプロイ設定
  - [ ] STGブランチ連携設定
- [ ] STG用PostgreSQL接続設定
  - [ ] Render PostgreSQLサービス作成（STG）
  - [ ] database.ymlSTG環境設定
  - [ ] STGデータベース接続テスト
- [ ] STG環境変数設定
  - [ ] SECRET_KEY_BASE設定（STG）
  - [ ] DATABASE_URL設定（STG）
  - [ ] Google OAuth設定（STG別）

**完了条件**:
- RenderSTG環境へのデプロイが成功している
- STG環境でアプリケーションが正常に動作している
- STG用PostgreSQLデータベースに接続できている

---

### 1-6. Google OAuth認証機能実装 - 3SP

**概要**: Devise gemとGoogle OAuthを使用したユーザー認証システムの実装

**詳細タスク**:
- [x] Devise gem設定
  - [x] `rails generate devise:install`実行
  - [x] devise設定ファイル調整
  - [x] Userモデル生成・マイグレーション
- [x] Google OAuth設定
  - [x] Google Cloud Console設定
  - [x] OAuth 2.0 クライアントID作成
  - [x] omniauth-google-oauth2 gem設定
- [x] ログイン・ログアウト機能
  - [x] devise viewsカスタマイズ
  - [x] Googleログインボタン実装
  - [x] ログアウト機能実装
  - [x] 認証後のリダイレクト設定

**完了条件**:
- Googleアカウントでのログインが機能している
- ログアウト機能が正常に動作している
- 未認証ユーザーは適切にリダイレクトされる
- ユーザー情報が正しくデータベースに保存されている

---

## Phase 2: ユーザー・権限管理

### 2-1. ユーザー管理機能実装 - 3SP

**概要**: ユーザー情報管理と新規ユーザーの承認待ち機能を実装

**詳細タスク**:
- [x] Users モデル・テーブル拡張
  - [x] マイグレーション作成・実行
  - [x] バリデーション設定
  - [x] 関連付け設定（belongs_to :department等）
- [x] 承認待ち状態管理
  - [x] ステータス管理（pending, approved, rejected）
  - [x] AASM gem使用の状態遷移定義
  - [x] 承認・拒否メソッド実装
- [x] 新規ユーザー承認待ち画面作成
  - [x] 承認待ち専用コントローラー・ビュー作成
  - [x] 承認待ち中のメッセージ表示
  - [x] 連絡先案内・手順説明表示

**完了条件**:
- 新規ユーザーは自動的に承認待ち状態になる
- 承認待ち画面が適切に表示される
- ユーザー状態の変更が正常に動作する
- データベース設計が要件を満たしている

---

### 2-2. 部署管理機能実装 - 2SP

**概要**: 部署の作成・編集・削除機能と部署担当者管理

**詳細タスク**:
- [x] Departments モデル・テーブル作成
  - [x] テーブル設計（name, description, department_type等）
  - [x] マイグレーション作成・実行
  - [x] バリデーション設定
  - [x] 関連付け設定（has_many :users等）
- [x] 部署CRUD機能
  - [x] DepartmentsController作成
  - [x] 部署一覧・詳細・新規作成・編集・削除機能
  - [x] 部署管理画面のビュー作成
  - [x] 部署担当者割り当て機能
  - [x] 権限チェック（管理者のみアクセス可能）

**完了条件**:
- 部署の作成・編集・削除が正常に動作する
- 部署担当者の設定ができる
- ユーザーと部署の関連付けが機能している
- 管理者権限でのみアクセス可能

---

### 2-3. 権限管理システム実装 - 3SP

**概要**: 3つの権限レベル（アルバイト/部署担当者/システム管理者）の実装

**詳細タスク**:
- [x] Roles, UserRoles モデル作成
  - [x] Rolesテーブル設計・作成
  - [x] UserRolesテーブル設計・作成（多対多関係）
  - [x] 初期ロールデータ作成（4つの権限レベル）
  - [x] モデル関連付け設定
- [x] Pundit gem権限制御
  - [x] ApplicationPolicy基底クラス作成
  - [x] 各機能別Policy作成
  - [x] 権限チェックメソッド実装
  - [x] ビューでの権限別表示制御
- [x] 管理者による新規ユーザー承認機能
  - [x] ユーザー承認画面作成
  - [x] 権限割り当て機能
  - [x] 一括承認・拒否機能
  - [x] 承認履歴管理

**完了条件**:
- 4つの権限レベルが正しく設定されている
- Punditによる権限制御が機能している
- 管理者がユーザーを承認・権限設定できる
- 権限に応じた画面表示制御が動作している

---

## Phase 3: コア機能（勤怠・シフト）

### 3-1. シフトモデル作成 - 2SP

**概要**: 月次シフト管理と日次スケジュールのデータモデル作成

**詳細タスク**:
- [x] Shifts, ShiftSchedules モデル作成
  - [x] Shiftsテーブル設計（月次シフト管理）
  - [x] ShiftSchedulesテーブル設計（日次スケジュール）
  - [x] 掛け持ちバイト時間フィールド追加
  - [x] マイグレーション作成・実行
  - [x] モデル関連付け・バリデーション

**完了条件**:
- ShiftsとShiftSchedulesモデルが正しく作成されている
- 掛け持ちバイト時間のフィールドが含まれている
- データベースマイグレーションが成功している
- モデル関連とバリデーションが機能している

---

### 3-2. シフト入力フォーム実装 - 3SP ✅

**概要**: 月次シフト希望提出フォームと動的ユーザーインターフェースの実装

**詳細タスク**:
- [x] 月次シフト入力フォーム（Vue.js）
  - [x] カレンダー形式のシフト入力UI
  - [x] 日次での勤務時間入力
  - [x] 掛け持ちバイト時間入力
  - [x] 入力時の計算表示
- [x] シフト提出・編集機能
  - [x] シフトデータの保存機能
  - [x] 編集モード切り替え
  - [x] 入力バリデーション

**完了条件**:
- ✅ 月次シフト希望が正しく提出できる
- ✅ 掛け持ちバイト時間を含む入力が可能
- ✅ Vue.jsでの動的UIが正常に動作している
- ✅ シフトデータの編集が機能している

---

### 3-3. 労働時間制限チェック機能実装 - 2SP ✅

**概要**: シフト入力時の労働時間制限の事前チェック機能

**詳細タスク**:
- [x] 週20h/40h制限の事前チェック機能
  - [x] 週単位での労働時間計算ロジック（休憩時間自動計算含む）
  - [x] 制限違反時のアラート表示
  - [x] 制限内での最大時間表示
  - [x] 入力値の動的検証（時間重複チェック含む）

**完了条件**:
- ✅ 労働時間制限のチェックが機能している
- ✅ 制限違反時のアラートが適切に表示される
- ✅ 入力時のリアルタイムチェックが動作している

---

### 3-4. 実勤怠労働時間集計機能実装 - 3SP ✅

**概要**: 勤怠データから週次労働時間を自動計算し、制限違反をチェック

**詳細タスク**:
- [x] 勤怠データからの週次労働時間自動計算
  - [x] 週単位での勤怠データ集計ロジック (`Attendance.weekly_hours_breakdown`)
  - [x] 弊社勤務時間と掛け持ちバイト時間の分離計算
  - [x] 休憩時間を除いた実労働時間計算
  - [x] 週の開始日設定（月曜開始等）
- [x] 制限違反時のアラート表示機能
  - [x] 週20時間制限（弊社分）チェック
  - [x] 週40時間制限（総労働時間）チェック
  - [x] 違反時のアラートメッセージ生成 (`Attendance.check_weekly_violations`)
  - [x] ダッシュボードでの警告表示（学生用ホーム画面）
  - [x] 管理者への通知機能（管理者ユーザー管理画面でのアラート表示）

**完了条件**:
- ✅ 週次労働時間が正確に計算される
- ✅ 制限違反が適切に検知される（エラー・警告の2段階）
- ✅ アラート表示が正常に機能する
- ✅ 管理者が制限違反を確認できる

---

### 3-5. 勤怠登録機能実装 - 3SP

**概要**: 日次の出退勤・休憩時間打刻機能と勤怠状況表示

**詳細タスク**:
- [x] TimeRecords モデル作成
  - [x] テーブル設計（出勤時刻、退勤時刻、休憩時間等）
  - [x] マイグレーション作成・実行
  - [x] バリデーション設定
  - [x] 関連付け設定（belongs_to :user等）
- [x] 出退勤・休憩時間打刻機能（Vue.js）
  - [x] 打刻ボタンUI作成
  - [x] 出勤・退勤・休憩開始・休憩終了の状態管理
  - [x] 打刻履歴の即座反映
- [x] 6時間以上勤務時の休憩時間自動計算
  - [x] 勤務時間（6時間以上）チェックロジック
  - [x] 1時間休憩時間自動計算・適用
  - [x] 休憩時間を除いた実労働時間計算
- [x] 勤怠状況一覧表示
  - [x] 日別・週別・月別勤怠一覧
  - [x] 労働時間集計表示
  - [x] 制限時間との比較表示

**完了条件**:
- 出退勤打刻が正常に記録される
- 休憩時間が自動計算される
- 勤怠一覧が正確に表示される
- Vue.jsでの基本的な動作が機能している

---

## Phase 4: 申請・承認ワークフロー

### 4-1. 欠勤申請機能実装 - 2SP ✅

**概要**: 欠勤申請機能の基盤実装

**詳細タスク**:
- [x] Applications モデル作成
  - [x] テーブル設計（申請種別、申請日、理由等）
  - [x] マイグレーション作成・実行
  - [x] バリデーション設定
- [x] 欠勤申請フォーム作成
  - [x] 申請種別選択（欠勤・遅刻・早退）
  - [x] 申請日・理由入力フォーム
  - [x] バリデーション・エラーハンドリング
- [x] 欠勤申請一覧表示
  - [x] 申請一覧ページ作成（applications/index.html.erb）
  - [x] 状態別フィルタリング
  - [x] 申請詳細表示機能

**完了条件**:
- ✅ 欠勤申請が正常に提出できる
- ✅ 申請一覧が表示される
- ✅ Applicationsモデルが正しく動作する

---

### 4-2. 遅刻・早退申請機能実装 - 2SP ✅

**概要**: 遅刻申請と早退申請フォームの実装

**詳細タスク**:
- [x] 遅刻申請フォーム作成
  - [x] 遅刻申請専用フォーム（申請種別選択）
  - [x] 日時選択機能
  - [x] 理由入力フィールド
- [x] 早退申請フォーム作成
  - [x] 早退申請専用フォーム（申請種別選択）
  - [x] 日時選択機能
  - [x] 理由入力フィールド
- [x] 申請状況一覧・詳細表示
  - [x] 申請状況一覧表示（applications/index.html.erb）
  - [x] 申請詳細画面
  - [x] 申請状況（pending, approved, rejected）表示

**完了条件**:
- ✅ 遅刻・早退申請が正常に提出できる
- ✅ 申請状況が適切に表示される
- ✅ 申請フォームのバリデーションが機能している

---

### 4-3. 承認モデル設計・実装 - 3SP ✅

**概要**: 承認システムの基盤となるモデルとAAMS状態管理の実装

**詳細タスク**:
- [x] Approvals モデル作成（ポリモーフィック）
  - [x] ポリモーフィック関連付け設計
  - [x] 承認者種別（department, labor）管理
  - [x] 承認状態管理（pending, approved, rejected）
  - [x] マイグレーション作成・実行
- [x] AASM gem状態管理
  - [x] 申請状態遷移定義
  - [x] 状態変更時のコールバック
  - [x] 状態履歴管理
- [x] 基本的な承認ロジック実装
  - [x] 承認・拒否メソッド実装
  - [x] 承認条件チェック

**完了条件**:
- ✅ Approvalsモデルが正しく作成されている
- ✅ AASM状態管理が機能している
- ✅ 基本的な承認ロジックが動作する

---

### 4-4. 承認システム実装（UI）- 2SP ✅

**概要**: 部署担当者用承認画面の実装

**既に実装済み**:
- ✅ Approvalモデル（ポリモーフィック、AASM状態管理）
- ✅ 部署承認ロジック（`check_and_update_status!`）
- ✅ 承認レコード自動生成（`create_approval_records`）
- ✅ 承認条件ロジック（部署承認完了チェック）

**詳細タスク**:
- [x] ApprovalsController作成
  - [x] index: 承認待ち一覧表示
  - [x] approve: 承認アクション
  - [x] reject: 却下アクション
- [x] ApprovalPolicy作成（Pundit）
  - [x] 部署担当者のみ自部署の承認可能
  - [x] システム管理者は承認権限なし（閲覧のみ）
- [x] 承認画面UI
  - [x] 承認待ち一覧（Applications）
  - [x] 承認/却下ボタン
  - [x] 申請詳細表示
- [x] ルーティング設定（/approvals）

**完了条件**:
- ✅ 部署担当者が承認待ち一覧を閲覧できる（/approvals）
- ✅ 承認/却下ボタンで申請のステータスが更新される
- ✅ 他部署の申請は表示されない（権限チェック）
- ✅ 承認後、申請のステータスがapprovedになる

**注**: 承認画面への導線（ダッシュボード統合）はPhase 5-1で実装予定

---

### 4-5. 承認UI・進捗表示実装 - 3SP → Phase 5-4に移動

**概要**: 承認状況の可視化とユーザビリティ向上

**注**: このタスクは **Phase 5-4「承認UI・進捗表示の改善」** に移動しました。
ダッシュボード実装後に行う方が効率的なため。

**Phase 5-4で実装予定の内容**:
- 申請者側の承認進捗表示（進捗バー、承認者情報）
- 部署担当者側の承認画面改善（ソート・フィルタ、モーダル表示）
- コメント入力機能（承認・却下時）
- リアルタイム更新（オプション）

---

### 4-6. 月末締め機能実装 - 2SP ✅

**概要**: 月末の勤怠締め処理機能

**詳細タスク**:
- [x] MonthEndClosings モデル作成
  - [x] 月末締めデータ管理テーブル
  - [x] 締め状況（open, closed）管理
  - [x] 締め日時記録
  - [x] マイグレーション作成・実行
- [x] 締め状況管理機能
  - [x] 月末締め実行機能
  - [x] 締め状況表示機能
  - [x] 締め履歴管理
- [x] 締め完了チェック機能
  - [x] 必要なデータの存在チェック
  - [x] 申請・承認完了チェック
  - [x] 締め後のデータ保護

**完了条件**:
- ✅ MonthEndClosingsモデルが正しく動作する
- ✅ 締め状況の管理機能が実装されている
- ✅ 締め完了チェックロジックが実装されている

**注**: UI実装（Controller、View）はPhase 5-3で実装予定

---

### 4-7. 外部システム連携機能実装 - 1SP → Phase 5-3に移動

**概要**: 月末締めチェックリストと外部システム（ラクロー・ジョブカン）連携UI

**注**: このタスクは **Phase 5-3「月末締め・外部システム連携UI実装」** に移動しました。
UI実装はダッシュボード実装後にまとめて行う方が効率的なため。

**Phase 5-3で実装予定の内容**:
- MonthEndClosingsController作成
- 月末締めチェックリスト画面
- ラクロー連携チェック項目（リンク、チェックボックス）
- ジョブカン連携チェック項目（リンク、チェックボックス）
- チェックリスト完了状況管理
- 締め履歴・ログ表示

---

## Phase 5: ダッシュボード・管理機能

### 5-1. ダッシュボード基盤実装 - 3SP

**概要**: 共通ダッシュボードレイアウトと権限別ナビゲーションの実装

**詳細タスク**:
- [ ] 共通ヘッダー・ナビゲーション実装
  - [ ] 権限別メニュー表示（Pundit）
  - [ ] 学生: シフト提出、勤怠登録、申請、履歴確認
  - [ ] 部署担当者: 上記 + 承認待ち一覧、部署メンバー管理
  - [ ] システム管理者: 上記 + ユーザー管理、部署管理
  - [ ] 承認待ち件数バッジ表示（部署担当者用）
- [ ] ホーム画面（ダッシュボード）の権限別表示
  - [ ] HomeControllerでの権限判定ロジック
  - [ ] 学生用: 労働時間状況、今日の勤怠、機能メニュー
  - [ ] 部署担当者用: 承認待ち一覧サマリ、部署メンバー状況
  - [ ] システム管理者用: 承認待ちユーザー、システム統計
- [ ] 共通UIコンポーネント作成
  - [ ] カード型レイアウト
  - [ ] ステータスバッジ
  - [ ] アラート表示
  - [ ] 基本スタイル統一

**完了条件**:
- ログイン後、権限に応じた適切なホーム画面が表示される
- ヘッダーナビゲーションが権限別に適切に表示される
- 部署担当者は承認待ち件数を確認できる
- 共通UIコンポーネントが全画面で利用可能

---

### 5-2. システム管理者機能強化 - 2SP

**概要**: ユーザー承認・部署管理機能の改善と管理画面の整備

**既存実装の確認**:
- ✅ Admin::UsersController（承認・却下・一括処理）
- ✅ DepartmentsController（CRUD機能）
- ✅ ユーザー承認待ち画面（pending_approvals）

**詳細タスク**:
- [ ] 管理者ダッシュボード統合
  - [ ] 承認待ちユーザー数の表示
  - [ ] 最近の承認履歴表示
  - [ ] システム統計（ユーザー数、部署数等）
- [ ] ユーザー管理画面の改善
  - [ ] 検索・フィルタリング機能
  - [ ] 一覧表示の情報充実（所属部署、権限、最終ログイン等）
  - [ ] 権限変更機能（編集画面から）
- [ ] 部署管理画面の改善
  - [ ] 部署別メンバー一覧の充実
  - [ ] 部署担当者の設定UI改善
  - [ ] 部署統計情報表示

**完了条件**:
- システム管理者が効率的にユーザー・部署を管理できる
- 承認待ちユーザーの処理が迅速に行える
- 検索・フィルタリングが正常に機能する

---

### 5-3. 月末締め・外部システム連携UI実装 - 2SP

**概要**: 月末締めチェックリストと外部システム連携ガイドの実装

**既存実装の確認**:
- ✅ MonthEndClosingsモデル（締め状況管理）

**詳細タスク**:
- [ ] 月末締めチェックリスト画面作成
  - [ ] MonthEndClosingsController作成
  - [ ] 月別締め状況一覧表示
  - [ ] 締め実行ボタン・確認ダイアログ
  - [ ] 締め後の編集制限メッセージ
- [ ] 外部システム連携チェックリスト
  - [ ] ラクロー連携チェック項目
    - [ ] 「ラクローで勤怠データを確認」リンク
    - [ ] 「給与計算に誤りがないか確認」チェックボックス
  - [ ] ジョブカン連携チェック項目
    - [ ] 「ジョブカンで交通費を申請」リンク
    - [ ] 「承認ルートが正しく設定されているか確認」チェックボックス
  - [ ] チェック完了状況の保存
- [ ] 締め履歴・ログ表示
  - [ ] 過去の締め履歴一覧
  - [ ] 締め実行者・日時の記録表示

**完了条件**:
- 月末締め処理がチェックリスト形式で実行できる
- 外部システム連携の漏れを防止できる
- 締め履歴が適切に記録・表示される
- 締め後のデータ編集が制限される

---

### 5-4. 承認UI・進捗表示の改善 - 2SP

**概要**: 承認状況の可視化とユーザビリティ向上（Phase 4-5の実装）

**既存実装の確認**:
- ✅ ApprovalsController + 承認画面
- ✅ Approvalモデル（AASM状態管理）

**詳細タスク**:
- [ ] 申請者側の承認進捗表示
  - [ ] 申請一覧での承認状況バッジ表示
  - [ ] 申請詳細での承認フロー進捗バー
  - [ ] 承認者情報・承認日時の表示
- [ ] 部署担当者側の承認画面改善
  - [ ] 承認待ち一覧のソート・フィルタ機能
  - [ ] 申請詳細モーダル表示（Vue.js）
  - [ ] コメント入力機能（承認・却下時）
  - [ ] 一括承認機能のUI改善
- [ ] リアルタイム更新（オプション）
  - [ ] 承認状況の自動リフレッシュ
  - [ ] 新規承認待ち通知バッジ

**完了条件**:
- 申請者が承認状況を視覚的に確認できる
- 部署担当者が効率的に承認処理を行える
- 承認時のコメント機能が動作する
- UIが直感的で分かりやすい

---

### 5-5. 日次勤怠サマリバッチ実装 - 2SP

**概要**: 日次での勤怠データ集計自動化

**詳細タスク**:
- [ ] Sidekiq基本設定
  - [ ] Sidekiq gem設定
  - [ ] Redis接続設定
  - [ ] ジョブキュー設定
- [ ] 日次勤怠サマリジョブ作成
  - [ ] DailyAttendanceSummaryJobクラス作成
  - [ ] 前日分の打刻データ集計ロジック
  - [ ] AttendanceSummaryテーブル作成・保存処理
  - [ ] エラーハンドリング・リトライ設定
- [ ] 手動実行機能
  - [ ] 管理者用バッチ実行画面作成
  - [ ] 実行履歴・結果表示
  - [ ] 実行状況モニタリング

**完了条件**:
- 日次バッチが手動で実行できる
- 勤怠サマリが正確に作成される
- エラー発生時に適切に処理される
- 実行履歴が記録される

---

### 5-6. 週次労働時間チェックバッチ実装 - 2SP

**概要**: 週次労働時間制限チェック機能の実装（MVP必須バッチ処理）

**既存実装の確認**:
- ✅ Attendance.check_weekly_violations（リアルタイムチェック）
- ✅ Attendance.weekly_hours_breakdown（週次集計）

**詳細タスク**:
- [ ] 週次労働時間チェックジョブ作成
  - [ ] WeeklyHoursCheckJobクラス作成
  - [ ] 全学生アルバイトの週次労働時間計算
  - [ ] 制限違反検知（週20h/40h）
  - [ ] 違反時のアラート・警告生成
- [ ] バッチ実行機能
  - [ ] 手動バッチ実行機能（管理者用）
  - [ ] 定期実行設定（sidekiq-cron）
  - [ ] 実行履歴・結果表示
- [ ] チェック結果のダッシュボード表示
  - [ ] 管理者向け違反一覧表示
  - [ ] 学生向けアラート表示（既存機能の統合）
  - [ ] 部署担当者向け部署内違反通知

**完了条件**:
- 週次労働時間制限違反が正しく検知される
- バッチが手動・自動で実行できる
- チェック結果がダッシュボードに表示される
- 違反時に適切な通知が行われる

---

## Phase 6: 品質向上・完成

### 6-1. 最終調整・バグ修正 - 4SP

**概要**: UI/UX改善、総合テスト、パフォーマンス最適化

**詳細タスク**:
- [ ] UI/UX調整・改善
  - [ ] 全画面のデザイン統一
  - [ ] エラーメッセージの分かりやすさ向上
- [ ] 総合テスト・修正
  - [ ] 全機能の結合テスト
  - [ ] 権限別機能テスト
  - [ ] ブラウザ間互換性テスト
  - [ ] パフォーマンステスト
  - [ ] 発見されたバグの修正
- [ ] パフォーマンス最適化
  - [ ] データベースクエリ最適化
  - [ ] Vue.jsコンポーネント最適化
  - [ ] 画像・アセット最適化
  - [ ] キャッシュ戦略実装
- [ ] ユーザビリティ改善
  - [ ] 操作フローの改善
  - [ ] フィードバック・ヘルプ機能追加
  - [ ] エラー処理の改善
  - [ ] ローディング状態の表示改善

**完了条件**:
- 全機能が安定して動作する
- パフォーマンスが要求水準を満たしている
- ユーザビリティが十分に向上している
- 本番運用に耐えうる品質に達している

---

## MVP後の拡張機能

### 通知システム基盤実装

**概要**: メール・Slack通知の基盤システム構築

**詳細タスク**:
- [x] 通知テーブル設計・作成
  - [x] Notifications モデル作成
  - [x] 通知タイプ・送信先管理
  - [x] 通知履歴・配信状況記録
- [ ] メール通知機能
  - [ ] ActionMailer設定
  - [ ] メールテンプレート作成
  - [ ] 承認・申請完了通知
- [ ] 通知設定管理
  - [ ] ユーザー別通知設定
  - [ ] 通知ON/OFF切り替え
  - [ ] 通知頻度設定

### 月次勤怠集計レポート

**概要**: 月次での勤怠データ集計・レポート機能

**詳細タスク**:
- [ ] 勤怠集計機能
  - [ ] 月次勤怠データ集計ロジック
  - [ ] 部署別・個人別集計
  - [ ] 労働時間・制限違反集計
- [ ] レポート出力機能
  - [ ] PDF/Excel出力機能
  - [ ] グラフ・チャート生成
  - [ ] 管理者向けサマリレポート
- [ ] レポート配信機能
  - [ ] 定期レポート自動配信
  - [ ] メール添付・送信機能
  - [ ] レポート履歴管理

### RSpec（モデルテスト・システムテスト）

**概要**: テストコード整備による品質向上

**詳細タスク**:
- [ ] RSpec環境構築
  - [ ] rspec-rails gem導入
  - [ ] factory_bot, capybara等のテスト用gem
  - [ ] テスト用データベース設定
- [ ] モデルテスト作成
  - [ ] User, Department, Shift等モデルテスト
  - [ ] バリデーション・関連付けテスト
  - [ ] ビジネスロジックテスト
- [ ] システムテスト作成
  - [ ] ログイン・認証フローテスト
  - [ ] 申請・承認ワークフローテスト
  - [ ] UI操作・画面遷移テスト

### CI（GitHubActions）

**概要**: 継続的インテグレーション環境構築

**詳細タスク**:
- [ ] GitHub Actions設定
  - [ ] .github/workflows/ci.yml作成
  - [ ] テスト実行環境構築
  - [ ] PostgreSQL・Redis サービス設定
- [ ] 自動テスト実行
  - [ ] プルリクエスト時の自動テスト
  - [ ] main ブランチマージ時のテスト
  - [ ] テスト結果通知設定
- [ ] デプロイ自動化
  - [ ] STG環境自動デプロイ
  - [ ] 本番デプロイ承認フロー
  - [ ] デプロイ後の動作確認自動化

### Slack通知機能

**概要**: 業務フローに合わせたSlack通知機能

**詳細タスク**:
- [ ] Slack API連携
  - [ ] Slack アプリ作成・設定
  - [ ] Webhook URL設定
  - [ ] 認証・権限設定
- [ ] 通知機能実装
  - [ ] 申請・承認完了通知
  - [ ] 労働時間制限違反アラート
  - [ ] 月末締め完了通知
- [ ] 通知カスタマイズ
  - [ ] チャンネル別通知設定
  - [ ] メンション・通知対象設定
  - [ ] 通知テンプレート管理

---

## 各issueでの説明欄テンプレート

```markdown
## 概要
[機能の概要を簡潔に記載]

## 作業内容
- [ ] [具体的なタスク1]
- [ ] [具体的なタスク2]
- [ ] [具体的なタスク3]

## 完了条件
- [完了の判断基準1]
- [完了の判断基準2]
- [完了の判断基準3]

## 関連ファイル・技術
- [関連するファイルパス]
- [使用する技術・gem]

## 注意事項
- [実装時の注意点があれば記載]
```