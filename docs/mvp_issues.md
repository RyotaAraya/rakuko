# 学生アルバイト勤怠管理システム「楽工」MVP Issue一覧

## 開発能力
- 週間開発時間：22時間（平日2h×5 + 土日6h×2）
- 開発期間：6週間
- 総開発時間：132時間
- 利用可能ストーリーポイント：66SP

## MVP Issue一覧（開発順序）

### Phase 1: 基盤構築
1-1. **Docker環境構築 + Rails新規プロジェクト作成** - 3SP
   - Docker環境構築（Dockerfile, docker-compose.yml）
   - Docker内でrails new rakuko --database=postgresql
   - 基本gem導入（devise gem, omniauth-google-oauth2 gem, pundit gem, aasm gem等）
   - Gemfile設定・初期セットアップ

1-2. **Vue.js + TypeScript環境構築** - 2SP
   - Vue.js 3 + TypeScript部分組み込み設定
   - vite_rails gem導入と設定
   - Docker内でのVite + Rails連携確認

1-3. **トップページ作成** - 2SP
   - ランディングページ（Vue.js）
   - 基本レイアウト・デザイン
   - 初期ルーティング設定

1-4. **Render本番環境構築** - 2SP
   - Render本番環境設定
   - PostgreSQL接続設定
   - 環境変数設定・管理

1-5. **RenderSTG環境構築** - 1SP
   - RenderSTG環境設定
   - STG用PostgreSQL接続設定
   - STG環境変数設定

1-6. **Google OAuth認証機能実装** - 3SP
   - Devise gem + omniauth-google-oauth2 gem設定
   - ログイン・ログアウト機能

### Phase 2: ユーザー・権限管理
2-1. **ユーザー管理機能実装** - 3SP
   - Users モデル・テーブル作成
   - 承認待ち状態管理
   - 新規ユーザー承認待ち画面作成

2-2. **部署管理機能実装** - 2SP
   - Departments モデル・テーブル作成
   - 部署CRUD機能

2-3. **権限管理システム実装** - 3SP
   - Roles, UserRoles モデル作成
   - Pundit gem権限制御
   - 管理者による新規ユーザー承認機能

### Phase 3: コア機能（勤怠・シフト）
3-1. **週中心シフトモデル作成** - 2SP
   - Weeks, WeeklyShifts, DailySchedules, MonthlySummaries モデル作成
   - テーブル設計・マイグレーション（週中心設計）
   - モデル関連付け・バリデーション
   - **時刻データをstring型で保存**（タイムゾーン問題の回避）

3-2. **シフト入力フォーム実装** - 3SP
   - Vue.jsシフト入力コンポーネント作成
   - 日次掛け持ちバイト時間入力機能
   - シフト提出・編集機能（**承認不要**）
   - 月跨ぎ週の前月データ参照表示

3-3. **労働時間制限チェック機能実装** - 2SP
   - 週20h/40h制限の事前チェック機能
   - 制限違反時のアラート表示
   - 入力時のリアルタイムチェック
   - **バックエンド権限チェック実装**（セキュリティ）

3-4. **実勤怠労働時間集計機能実装** - 3SP
   - 勤怠データからの週次労働時間自動計算
   - 制限違反時のアラート表示機能

3-5. **勤怠登録機能実装** - 3SP
    - TimeRecords, Attendances モデル作成
    - 出退勤・休憩時間打刻機能（Vue.js）
    - **複数回休憩対応**（break_sequence）
    - **退勤時の自動Attendance生成**
    - 勤怠状況一覧表示（今日・週間・月別）
    - 週間労働時間予測表示

### Phase 4: 申請・承認ワークフロー
4-1. **欠勤申請機能実装** - 1SP
    - Applications モデル作成
    - 欠勤申請フォーム作成
    - 欠勤申請一覧表示

4-2. **遅刻・早退申請機能実装** - 2SP
    - 遅刻申請フォーム作成
    - 早退申請フォーム作成
    - 申請状況一覧・詳細表示

4-3. **承認モデル設計・実装** - 3SP
    - Approvals モデル作成（ポリモーフィック）
    - **AASM gem状態管理**（Application、Attendance、Approval）
    - 基本的な承認ロジック実装
    - **シフト希望は承認対象外**（週20h/40h制限はバリデーションで保証）

4-4. **承認システム実装（UI）** - 2SP
    - ✅ 承認ロジック実装済み（Approvalモデル・AASM・承認条件）
    - ApprovalsController作成
    - 部署担当者用承認待ち一覧画面
    - 承認/却下アクションUI
    - ApprovalPolicy作成（Pundit認可：部署担当者のみ）
    - **Applications**: 部署承認のみ
    - **Attendances**: 部署承認のみ（未実装だが同様の仕組み）
    - **注**: システム管理者は承認権限なし

4-5. **承認UI・進捗表示実装** - 3SP
    - 承認状況可視化・進捗表示（Vue.js）
    - 基本的な状況更新機能
    - 承認完了画面表示機能

4-6. **月末締め機能実装** - 2SP
    - MonthEndClosings モデル作成
    - 締め状況管理機能
    - 締め完了チェック機能

4-7. **外部システム連携機能実装** - 1SP
    - ラクロー遷移リンク機能
    - ジョブカン遷移リンク機能
    - 交通費申請リマインダー表示

### Phase 5: 管理機能・自動化
5-1. **ダッシュボード基盤実装** - 2SP
    - 共通UI基盤作成
    - Pundit gem権限別表示切り替え
    - 基本レイアウト作成

5-2. **ユーザータイプ別ダッシュボード実装** - 4SP
    - アルバイト用ダッシュボード
    - 部署担当者用ダッシュボード
    - 労務担当者用ダッシュボード
    - システム管理者用ダッシュボード

5-3. **新規ユーザー承認・部署管理機能実装** - 3SP
    - 新規ユーザー承認機能（一覧・個別・一括承認）
    - 権限設定・部署割り当て機能
    - 部署担当者設定・変更機能
    - 部署メンバー管理機能

5-4. **日次勤怠サマリバッチ実装** - 2SP
    - Sidekiqジョブ作成
    - 日次勤怠サマリ作成ロジック
    - バッチ実行スケジュール設定

5-5. **週次労働時間チェック機能実装** - 2SP
    - 週次労働時間計算ロジック
    - 制限違反検知ロジック（週20h/40h）
    - 違反時のアラート・警告生成
    - **掛け持ちバイト予定時間を実績として利用**（実績記録の管理コスト削減）

### Phase 6: 品質向上・完成
6-1. **コード品質向上** - 2SP
    - RuboCop違反修正（95件 → 0件）
    - TypeScript型エラー修正
    - フロントエンドlint対応（Biome）

6-2. **セキュリティ強化** - 1SP
    - バックエンド権限チェック追加
    - フロントエンド/バックエンド二重チェック実装

6-3. **最終調整・バグ修正** - 4SP
    - UI/UX調整・改善
    - 総合テスト・修正
    - パフォーマンス最適化
    - ユーザビリティ改善
    - **タイムゾーン問題の解決**（time型 → string型）

## 合計：74SP（6-1, 6-2追加により3SP増）

## 主要な技術的成果

### アーキテクチャ
- ✅ **週中心設計**: 月跨ぎ問題を根本的に解決
- ✅ **AASM状態管理**: Application、Attendance、Approvalの状態遷移を明確化
- ✅ **ポリモーフィック承認システム**: 部署担当者による承認フローの実装
- ✅ **Pundit権限制御**: 4つのロール（学生、部署管理者、労務、システム管理者）

### データ設計
- ✅ **時刻データをstring型で保存**: タイムゾーン変換問題を完全に回避
- ✅ **複数回休憩対応**: break_sequenceによる柔軟な休憩記録
- ✅ **契約期間連動**: ユーザーの契約期間に基づく週テーブル自動生成

### セキュリティ・品質
- ✅ **二重権限チェック**: フロントエンド + バックエンド
- ✅ **RuboCop完全対応**: 0件の違反
- ✅ **TypeScript型安全性**: すべての型エラー解消
- ✅ **Biome lint対応**: フロントエンドコード品質向上

### UX・機能
- ✅ **承認不要のシフト提出**: 学業優先の柔軟な変更を実現
- ✅ **当月編集可能**: 過去月のみ編集不可、当月・来月以降は編集可能
- ✅ **週間労働時間予測**: 実績 + 残り予定で自動計算
- ✅ **掛け持ちバイト管理**: 予定時間を実績として利用（管理コスト削減）

## MVP後の拡張機能
- [ ] 通知システム基盤実装
- [ ] 月次勤怠集計レポート
- [ ] RSpec（モデルテスト・システムテスト）
- [ ] CI（GitHubActions）
- [ ] Slack通知機能

## MVPレビュー依頼予定日
- 2025年11月4日
