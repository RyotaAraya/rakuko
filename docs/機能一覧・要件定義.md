# 機能一覧・要件定義

## 機能カテゴリ別一覧

### 🔐 認証・権限管理
| 機能名 | 詳細 | 優先度 | 対象ユーザー |
|--------|------|--------|-------------|
| ログイン機能 | メール・パスワードによる認証 | 高 | 全員 |
| ロール管理 | 学生/部署担当者の権限分離 | 高 | 全員 |
| パスワードリセット | メール経由でのパスワード再設定 | 中 | 全員 |

### 📅 シフト管理
| 機能名 | 詳細 | 優先度 | 対象ユーザー |
|--------|------|--------|-------------|
| シフト希望提出 | カレンダー形式での希望時間入力 | 高 | 学生 |
| 週20時間制限チェック | リアルタイムでの制限確認 | 高 | 学生/管理者 |
| 掛け持ちバイト時間管理 | 他バイト時間との合計40時間チェック | 高 | 学生/管理者 |
| シフト再編集機能 | 提出後も制限内であれば再編集可能 | 高 | 学生 |
| シフト一覧表示 | 部署全体のシフト可視化 | 中 | 管理者 |

### ⏰ 勤怠管理
| 機能名 | 詳細 | 優先度 | 対象ユーザー |
|--------|------|--------|-------------|
| 出退勤登録 | 時刻・休憩時間の登録 | 高 | 学生 |
| 休憩時間自動チェック | 6時間以上勤務時の1時間休憩確認 | 高 | 学生/管理者 |
| 実労働時間計算 | 出退勤時刻から休憩時間を除いた実労働時間算出 | 高 | 学生/管理者 |
| 勤怠自動承認 | 打刻データから自動生成された勤怠は自動承認（PCログ参照用） | 高 | 全員 |
| PCログ照合 | 実際の勤務時間はRakuroのPCログで確認（打刻は参考データ） | 中 | 管理者 |
| 週/月次集計 | 労働時間の自動集計 | 中 | 全員 |

### 📝 申請管理
| 機能名 | 詳細 | 優先度 | 対象ユーザー |
|--------|------|--------|-------------|
| 欠勤申請 | 欠勤理由・日付の申請 | 高 | 学生 |
| 遅刻申請 | 遅刻理由・日付の申請（時刻は理由欄に記載） | 高 | 学生 |
| 早退申請 | 早退理由・日付の申請（時刻は理由欄に記載） | 高 | 学生 |
| 申請取り消し | 承認待ち申請の取り消し（承認済みは不可） | 高 | 学生 |
| 交通費申請 | 経路・金額・領収書添付 | 中 | 学生 |
| 申請承認フロー | 部署担当者による承認 | 高 | 部署担当者 |
| 申請一覧・状況確認 | 申請履歴と承認状況の確認（承認待ち/承認済み/却下/取り消し） | 中 | 学生 |

### 📊 レポート・分析
| 機能名 | 詳細 | 優先度 | 対象ユーザー |
|--------|------|--------|-------------|
| 制約違反レポート | 週20時間・合計40時間超過者一覧 | 高 | 管理者 |
| 勤怠集計レポート | 部署別・個人別の勤怠サマリー | 中 | 管理者 |
| ダッシュボード | 各ユーザー向けの概要表示 | 高 | 全員 |
| アラート機能 | 制約違反時の自動通知 | 中 | 全員 |

### 🔗 外部ツール連携・月末締め
| 機能名 | 詳細 | 優先度 | 対象ユーザー |
|--------|------|--------|-------------|
| 月末締め作業管理 | ジョブカン・ラクロー作業完了チェック | 高 | 全員 |
| 外部ツールリンク | ジョブカン・ラクローへの直接リンク | 高 | 学生 |
| 締め作業承認フロー | 部署担当者による承認 | 高 | 部署担当者 |
| 締切リマインド | 最終出社日のSlack通知 | 中 | 学生/管理者 |
| 締め作業履歴管理 | 月別の締め作業完了状況記録 | 中 | 管理者 |

### 🔔 通知機能
| 機能名 | 詳細 | 優先度 | 対象ユーザー |
|--------|------|--------|-------------|
| 申請状況通知 | 申請承認・差し戻し時の通知 | 中 | 学生 |
| 制約違反通知 | 時間超過時の自動アラート | 高 | 学生/管理者 |
| 承認依頼通知 | 管理者への承認依頼通知 | 中 | 管理者 |

## ロール別権限詳細

### 学生（student）
- **シフト希望提出**: 作成・編集（当月・来月以降）、承認不要
- **勤怠登録**: 作成・編集
- **各種申請**: 作成（欠勤・遅刻・早退）
- **自分のデータ閲覧**: 自分のシフト・勤怠・申請履歴のみ閲覧可能

### 部署担当者（department_manager）
- **対象範囲**: 自部署のアルバイトのみ
- **シフト希望**: 閲覧のみ（承認不要）
- **勤怠**: 閲覧のみ（自動承認、実際の勤務時間はRakuroのPCログで確認）
- **各種申請**: 閲覧・承認（欠勤・遅刻・早退）
- **月末締め**: 閲覧・承認
- **部署内レポート**: 自部署の集計・レポート閲覧

### システム管理者（system_admin）
- **ユーザー管理**: 新規ユーザー承認・編集・削除
- **部署管理**: 部署作成・編集・削除
- **ロール管理**: ユーザーのロール切り替え
- **全データ閲覧**: 全部署のデータ閲覧可能（承認権限はなし）

**注**: システム管理者は承認業務は行わない。承認は部署担当者の役割。

### 承認フロー

| 対象 | 承認者 | 承認の有無 |
|------|--------|-----------|
| Shift（シフト希望） | - | 承認不要（週20h/40h制限はバリデーションで保証） |
| Application（欠勤・遅刻・早退） | 部署担当者 | 承認必要 |
| Attendance（勤怠） | - | 自動承認（打刻データは参考用、実際の勤務時間はRakuroのPCログで確認） |
| MonthEndClosing（月末締め） | 部署担当者 | 承認必要 |

## 非機能要件

### セキュリティ
- HTTPS通信必須
- パスワードのハッシュ化
- セッション管理
- CSRF対策
- SQL インジェクション対策

### パフォーマンス
- ページ読み込み時間 3秒以内
- 同時接続ユーザー数 50名対応
- データバックアップ（日次）

### 使いやすさ
- レスポンシブデザイン（スマートフォン対応）
- 直感的なUI/UX
- エラーメッセージの分かりやすさ

### 保守性
- コードの可読性
- テストカバレッジ 80% 以上
- ログ出力機能

## 開発優先度

### MVP（Minimum Viable Product）
1. **認証機能**（ログイン・ロール管理）
2. **シフト希望提出**（基本的なカレンダー入力、承認不要）
3. **週20時間制限チェック**（自動バリデーション）
4. **勤怠登録**（出退勤・休憩時間）
5. **勤怠承認**（管理者機能 - シフト希望は承認対象外）

### フェーズ2
1. **掛け持ちバイト管理**
2. **申請機能**（欠勤・遅刻・早退）
3. **月末締め作業管理**（外部ツール連携）
4. **PCログ照合**
5. **基本的なレポート機能**

### フェーズ3
1. **交通費申請・承認**
2. **締切リマインド機能**（Slack通知）
3. **詳細なレポート・分析**
4. **通知機能**
5. **UI/UX改善**

## 制約条件

### ビジネスルール
- 週20時間以内の実労働時間（学生アルバイト）※休憩時間除く
- 掛け持ちバイト含めて合計40時間/週以下（実労働時間ベース）
- 休憩時間は複数回取得可能、1時間以上も可
- 出退勤時刻の変更は事前連絡があればOK
- 勤務時間帯：9:00-18:00（基本）

### 技術制約
- フレームワーク：Rails + Vue.js
- データベース：PostgreSQL
- クラウド：未定（AWS/Heroku等）
- 既存システム（ラクロー）との連携は将来的に検討

### 運用制約
- 初期導入時は1部署のみ
- 将来的に全社展開を想定
- メンテナンス時間：土日の深夜帯

## 申請管理の状態遷移

### 申請ステータス
申請（欠勤・遅刻・早退）は以下の4つのステータスを持ちます：

| ステータス | 説明 | 表示名 |
|----------|------|--------|
| pending | 承認待ち | 承認待ち |
| approved | 承認済み | 承認済み |
| rejected | 却下 | 却下 |
| canceled | 取り消し | 取り消し |

### 状態遷移フロー

```
[新規申請]
    ↓
[承認待ち (pending)]
    ↓
    ├→ [承認 (approved)] ← 部署担当者が承認
    ├→ [却下 (rejected)] ← 部署担当者が却下
    └→ [取り消し (canceled)] ← 学生が取り消し

[却下 (rejected)]
    ↓
[編集・再申請] → [承認待ち (pending)] に戻る

[取り消し (canceled)]
    ↓
[編集・再申請] → [承認待ち (pending)] に戻る
```

### 学生が実行可能な操作

| 現在のステータス | 可能な操作 |
|----------------|----------|
| 承認待ち (pending) | 取り消し |
| 承認済み (approved) | 操作不可 |
| 却下 (rejected) | 編集・再申請 |
| 取り消し (canceled) | 編集・再申請 |

### 部署担当者が実行可能な操作

| 現在のステータス | 可能な操作 |
|----------------|----------|
| 承認待ち (pending) | 承認、却下 |
| 承認済み (approved) | 閲覧のみ |
| 却下 (rejected) | 閲覧のみ |
| 取り消し (canceled) | 表示されない（承認一覧から除外） |

### 注意事項
- 承認済み（approved）の申請は取り消しできません
- 取り消し済み（canceled）の申請は部署担当者の承認一覧に表示されません
- 却下（rejected）と取り消し（canceled）の申請は、学生が編集して再申請できます
- 再申請すると、新しい承認レコードが作成され、ステータスが「承認待ち」に戻ります