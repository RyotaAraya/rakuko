# ğŸ“‹ ã‚·ãƒ•ãƒˆæå‡ºæ©Ÿèƒ½ ä»•æ§˜æ›¸

## ğŸ“ æ¦‚è¦

å­¦ç”Ÿã‚¢ãƒ«ãƒã‚¤ãƒˆãŒæœˆé–“ã‚·ãƒ•ãƒˆå¸Œæœ›ã‚’æå‡ºã™ã‚‹æ©Ÿèƒ½ã€‚åŠ´åƒåŸºæº–æ³•éµå®ˆã®ãŸã‚ã€é€±20æ™‚é–“ï¼ˆè‡ªç¤¾ï¼‰+ æ›ã‘æŒã¡40æ™‚é–“åˆ¶é™ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã€‚

## ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

**AS A** å­¦ç”Ÿã‚¢ãƒ«ãƒã‚¤ãƒˆ
**I WANT TO** ã‚·ãƒ•ãƒˆå¸Œæœ›ã‚’ç°¡å˜ã«æå‡ºã—ã€åˆ¶é™ã‚’è¶…ãˆãªã„ã‚ˆã†ã«ç¢ºèªã—ãŸã„
**SO THAT** åŠ´åƒåŸºæº–æ³•ã‚’éµå®ˆã—ãªãŒã‚‰åŠ¹ç‡çš„ã«åƒã‘ã‚‹

## ğŸ¯ æ©Ÿèƒ½è¦ä»¶

### 1. ã‚·ãƒ•ãƒˆå…¥åŠ›æ©Ÿèƒ½

#### 1.1 æœˆé–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º
- **é€±å˜ä½è¡¨ç¤º**: æœˆã‚’5é€±ã«åˆ†å‰²ã—ã¦è¡¨ç¤º
- **æ—¥ä»˜è¡¨ç¤º**: å„æ—¥ã®æ›œæ—¥ã¨æ—¥ä»˜ã‚’æ˜ç¤º
- **æ™‚é–“å…¥åŠ›**: ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ã‚ˆã‚‹æ™‚åˆ»é¸æŠï¼ˆ15åˆ†åˆ»ã¿ï¼‰

#### 1.2 å‹¤å‹™æ™‚é–“å…¥åŠ›
- **å…¥åŠ›å½¢å¼**:
  - ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ï¼ˆ15åˆ†åˆ»ã¿ï¼‰
  - åˆæœŸè¡¨ç¤º: `--`ï¼ˆæœªé¸æŠçŠ¶æ…‹ï¼‰
- **æ™‚é–“ç¯„å›²**:
  - å¼Šç¤¾å‹¤å‹™: 09:00ã€œ18:00
  - æ›ã‘æŒã¡ãƒã‚¤ãƒˆ: 00:00ã€œ23:45
- **å…¥åŠ›åˆ¶é™**:
  - **å¯¾è±¡æœˆå¤–**: å‰æœˆãƒ»ç¿Œæœˆã®æ—¥ä»˜ã¯å…¥åŠ›ä¸å¯ï¼ˆå¼Šç¤¾ãƒ»æ›ã‘æŒã¡å…±é€šï¼‰
  - **åœŸæ—¥åˆ¶é™**: å¼Šç¤¾å‹¤å‹™ã®ã¿åœŸæ—¥ã¯å…¥åŠ›ä¸å¯
- **å¼Šç¤¾å‹¤å‹™**:
  - é–‹å§‹æ™‚é–“ãƒ»çµ‚äº†æ™‚é–“ã‚’å€‹åˆ¥å…¥åŠ›
  - å®ŸåŠ´åƒæ™‚é–“è¨ˆç®—: 6æ™‚é–“ä»¥ä¸Šã¯1æ™‚é–“ä¼‘æ†©è‡ªå‹•å·®ã—å¼•ã
- **æ›ã‘æŒã¡ãƒã‚¤ãƒˆ**:
  - é–‹å§‹æ™‚é–“ãƒ»çµ‚äº†æ™‚é–“ã‚’å€‹åˆ¥å…¥åŠ›
  - å®ŸåŠ´åƒæ™‚é–“è¨ˆç®—: åŒæ§˜ã«ä¼‘æ†©æ™‚é–“ã‚’è€ƒæ…®

#### 1.3 ä¸€æ‹¬å…¥åŠ›æ©Ÿèƒ½
- **å¯¾è±¡**: å…¨é€±ã®æœˆã€œé‡‘æ›œæ—¥ã«åŒã˜æ™‚é–“ã‚’ä¸€æ‹¬è¨­å®š
- **å…¥åŠ›æ–¹æ³•**: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§é–‹å§‹ãƒ»çµ‚äº†æ™‚é–“ã‚’å…¥åŠ›
- **é©ç”¨ç¯„å›²**: å¼Šç¤¾å‹¤å‹™ã®ã¿ï¼ˆæ›ã‘æŒã¡ã¯å€‹åˆ¥å…¥åŠ›ï¼‰

#### 1.4 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—
- **é€±å˜ä½è¨ˆç®—**: å„é€±ã®å¼Šç¤¾æ™‚é–“ + æ›ã‘æŒã¡æ™‚é–“
- **åˆ¶é™ãƒã‚§ãƒƒã‚¯**: é€±40æ™‚é–“åˆ¶é™ã®å¯è¦–åŒ–
- **è­¦å‘Šè¡¨ç¤º**: åˆ¶é™è¶…éæ™‚ã®èµ¤è‰²è­¦å‘Š

### 2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½

#### 2.1 åŠ´åƒæ™‚é–“åˆ¶é™
- **é€±20æ™‚é–“åˆ¶é™**: å¼Šç¤¾ã§ã®å®ŸåŠ´åƒæ™‚é–“ä¸Šé™ï¼ˆå­¦ç”Ÿãƒã‚¤ãƒˆæ³•çš„åˆ¶é™ï¼‰
- **é€±40æ™‚é–“åˆ¶é™**: å¼Šç¤¾ + æ›ã‘æŒã¡ã®åˆè¨ˆä¸Šé™ï¼ˆåŠ´åƒåŸºæº–æ³•åˆ¶é™ï¼‰
- **äºŒé‡ãƒã‚§ãƒƒã‚¯**: ä¸¡æ–¹ã®åˆ¶é™ã‚’ç‹¬ç«‹ã—ã¦æ¤œè¨¼
- **å®ŸåŠ´åƒæ™‚é–“è¨ˆç®—**:
  - 6æ™‚é–“æœªæº€: å®Ÿåƒæ™‚é–“ = å‹¤å‹™æ™‚é–“
  - 6æ™‚é–“ä»¥ä¸Š: å®Ÿåƒæ™‚é–“ = å‹¤å‹™æ™‚é–“ - 1æ™‚é–“ï¼ˆä¼‘æ†©ï¼‰

#### 2.2 å…¥åŠ›æ¤œè¨¼
- **å¿…é ˆå…¥åŠ›**: é–‹å§‹æ™‚é–“ã¨çµ‚äº†æ™‚é–“ã®ãƒšã‚¢
- **æ™‚é–“é †åº**: é–‹å§‹ < çµ‚äº†ã®æ¤œè¨¼
- **é‡è¤‡ãƒã‚§ãƒƒã‚¯**: å¼Šç¤¾ã¨æ›ã‘æŒã¡ã®æ™‚é–“é‡è¤‡æ¤œè¨¼

### 3. æå‡ºãƒ»ä¿å­˜æ©Ÿèƒ½

#### 3.1 ä¸‹æ›¸ãä¿å­˜
- **è‡ªå‹•ä¿å­˜**: å…¥åŠ›å¤‰æ›´æ™‚ã®è‡ªå‹•ä¿å­˜
- **æ‰‹å‹•ä¿å­˜**: ä¸‹æ›¸ãä¿å­˜ãƒœã‚¿ãƒ³
- **å¾©å…ƒæ©Ÿèƒ½**: å‰å›å…¥åŠ›å†…å®¹ã®å¾©å…ƒ

#### 3.2 æ­£å¼æå‡º
- **åˆ¶é™ãƒã‚§ãƒƒã‚¯**: æå‡ºå‰ã®æœ€çµ‚æ¤œè¨¼
- **ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°**: åˆ¶é™è¶…éæ™‚ã®ç¢ºèª
- **æå‡ºçŠ¶æ…‹ç®¡ç†**: æå‡ºå¾Œã‚‚å†ç·¨é›†å¯èƒ½ï¼ˆå­¦æ¥­å„ªå…ˆã®ãŸã‚ï¼‰

## ğŸ—ƒï¸ ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆé€±ä¸­å¿ƒè¨­è¨ˆï¼‰

### 1. é€±ä¸­å¿ƒãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ

#### weeks ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ï¼‰
```ruby
# é€±ã®åŸºæœ¬æƒ…å ±
create_table "weeks" do |t|
  t.date "start_date", null: false     # é€±é–‹å§‹æ—¥ï¼ˆæœˆæ›œæ—¥ï¼‰
  t.date "end_date", null: false       # é€±çµ‚äº†æ—¥ï¼ˆæ—¥æ›œæ—¥ï¼‰
  t.integer "year"                     # å¹´
  t.integer "week_number"              # å¹´å†…é€±ç•ªå·
  t.boolean "is_cross_month"           # æœˆè·¨ãé€±ãƒ•ãƒ©ã‚°
  t.timestamps
end
```

#### weekly_shifts ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ï¼‰
```ruby
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é€±é–“ã‚·ãƒ•ãƒˆ
create_table "weekly_shifts" do |t|
  t.bigint "user_id", null: false
  t.bigint "week_id", null: false
  t.integer "submission_month"         # æå‡ºå¯¾è±¡æœˆ
  t.integer "submission_year"          # æå‡ºå¯¾è±¡å¹´
  t.integer "status"                   # draft, submittedï¼ˆå†ç·¨é›†å¯èƒ½ï¼‰
  t.text "violation_warnings"          # åˆ¶é™é•åè­¦å‘Š
  t.datetime "submitted_at"            # æå‡ºæ—¥æ™‚
  t.timestamps
end
```

#### daily_schedules ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ï¼‰
```ruby
# æ—¥åˆ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è©³ç´°
create_table "daily_schedules" do |t|
  t.bigint "weekly_shift_id", null: false
  t.date "date"                        # å¯¾è±¡æ—¥
  t.string "company_start_time", limit: 8   # å¼Šç¤¾é–‹å§‹æ™‚é–“ï¼ˆHH:MMå½¢å¼ï¼‰
  t.string "company_end_time", limit: 8     # å¼Šç¤¾çµ‚äº†æ™‚é–“ï¼ˆHH:MMå½¢å¼ï¼‰
  t.string "sidejob_start_time", limit: 8   # æ›ã‘æŒã¡é–‹å§‹æ™‚é–“ï¼ˆHH:MMå½¢å¼ï¼‰
  t.string "sidejob_end_time", limit: 8     # æ›ã‘æŒã¡çµ‚äº†æ™‚é–“ï¼ˆHH:MMå½¢å¼ï¼‰
  t.boolean "is_company_working"       # å¼Šç¤¾å‹¤å‹™ãƒ•ãƒ©ã‚°
  t.boolean "is_sidejob_working"       # æ›ã‘æŒã¡ãƒ•ãƒ©ã‚°
  t.timestamps
end
```

**é‡è¦ãªè¨­è¨ˆåˆ¤æ–­: æ™‚åˆ»ãƒ‡ãƒ¼ã‚¿ã‚’stringå‹ã§ä¿å­˜**
- PostgreSQLã®timeå‹ã§ã¯ãªãã€stringå‹ï¼ˆlimit: 8ï¼‰ã§HH:MMå½¢å¼ã®æ–‡å­—åˆ—ã¨ã—ã¦ä¿å­˜
- ç†ç”±: timeå‹ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€Railsã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è¨­å®šã«ã‚ˆã‚Šè‡ªå‹•çš„ã«UTC/JSTã®å¤‰æ›ãŒç™ºç”Ÿã—ã€ã€Œ08:00ã€ãŒã€Œ17:00ã€ã«ãªã‚‹ãªã©ã®å•é¡ŒãŒç™ºç”Ÿ
- ã‚·ãƒ•ãƒˆå¸Œæœ›ã®ã€Œæ™‚åˆ»ã€ã¯æ—¥ä»˜ã«ä¾å­˜ã—ãªã„ç´”ç²‹ãªæ™‚é–“æƒ…å ±ã§ã‚ã‚Šã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æ¦‚å¿µãŒä¸è¦
- å…¥åŠ›å€¤"08:00"ãŒãã®ã¾ã¾"08:00"ã¨ã—ã¦ä¿å­˜ãƒ»è¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€å®Ÿè£…ãŒå˜ç´”ã‹ã¤ç›´æ„Ÿçš„

#### monthly_summaries ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ï¼‰
```ruby
# æœˆæ¬¡é›†è¨ˆæƒ…å ±
create_table "monthly_summaries" do |t|
  t.bigint "user_id", null: false
  t.integer "year"
  t.integer "month"
  t.decimal "total_company_hours", precision: 5, scale: 2
  t.decimal "total_sidejob_hours", precision: 5, scale: 2
  t.decimal "total_all_hours", precision: 5, scale: 2
  t.integer "status"                   # draft, submittedï¼ˆå†ç·¨é›†å¯èƒ½ï¼‰
  t.timestamps
end
```

### 2. é€±ä¸­å¿ƒãƒ‡ãƒ¼ã‚¿ä¿å­˜ä»•æ§˜

#### 2.1 é€±é–“ã‚·ãƒ•ãƒˆä½œæˆ
```ruby
# 1. å¯¾è±¡æœˆã®é€±ã‚’å–å¾—
target_date = Date.new(2025, 10, 1)
weeks_in_month = Week.for_month(target_date.year, target_date.month)

# 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é€±é–“ã‚·ãƒ•ãƒˆä½œæˆ
weeks_in_month.each do |week|
  weekly_shift = WeeklyShift.create!(
    user: current_user,
    week: week,
    submission_month: target_date.month,
    submission_year: target_date.year,
    status: :draft
  )

  # 3. å„æ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ
  (week.start_date..week.end_date).each do |date|
    # æå‡ºå¯¾è±¡æœˆã®æ—¥ä»˜ã®ã¿ä½œæˆ
    if date.month == target_date.month
      weekly_shift.daily_schedules.create!(
        date: date,
        company_start_time: company_times[date][:start],
        company_end_time: company_times[date][:end],
        sidejob_start_time: sidejob_times[date][:start],
        sidejob_end_time: sidejob_times[date][:end],
        is_company_working: company_working_days.include?(date),
        is_sidejob_working: sidejob_working_days.include?(date)
      )
    end
  end
end

# 4. æœˆæ¬¡ã‚µãƒãƒªãƒ¼ä½œæˆ
MonthlySummary.create!(
  user: current_user,
  year: target_date.year,
  month: target_date.month,
  status: :draft
)
```

#### 2.2 é€±é–“åˆ¶é™ãƒã‚§ãƒƒã‚¯çµæœï¼ˆæœˆè·¨ãå¯¾å¿œï¼‰
```ruby
# violation_warnings ã« JSON ã§ä¿å­˜ï¼ˆäºŒé‡ãƒã‚§ãƒƒã‚¯å¯¾å¿œï¼‰
[
  {
    "week_id": 44,
    "week_start": "2025-10-27",
    "week_end": "2025-11-02",
    "company_hours": 22.0,
    "sidejob_hours": 25.0,
    "total_hours": 47.0,
    "previous_month_hours": {
      "company": 14.0,
      "sidejob": 12.0,
      "dates": ["2025-10-27", "2025-10-28", "2025-10-29", "2025-10-30", "2025-10-31"]
    },
    "current_month_hours": {
      "company": 8.0,
      "sidejob": 13.0,
      "dates": ["2025-11-01", "2025-11-02"]
    },
    "violations": [
      {
        "type": "company_hours_exceeded",
        "limit": 20,
        "actual": 22.0,
        "message": "å¼Šç¤¾ã§ã®é€±20æ™‚é–“åˆ¶é™ã‚’è¶…é"
      },
      {
        "type": "total_hours_exceeded",
        "limit": 40,
        "actual": 47.0,
        "message": "é€±40æ™‚é–“åˆ¶é™ã‚’è¶…éï¼ˆå¼Šç¤¾+æ›ã‘æŒã¡ï¼‰"
      }
    ]
  }
]
```

## ğŸ”§ æŠ€è¡“ä»•æ§˜

### 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆVue.jsï¼‰

#### 1.1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ
```
ShiftRequestForm.vue (è¦ª)
â”œâ”€â”€ WeekShiftInput.vue (é€±å˜ä½å…¥åŠ›)
â”œâ”€â”€ HourCalculator.js (æ™‚é–“è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯)
â””â”€â”€ ValidationChecker.js (åˆ¶é™ãƒã‚§ãƒƒã‚¯)
```

#### 1.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
```javascript
// è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®çŠ¶æ…‹ç®¡ç†
const weeks = ref([
  {
    id: 1,
    title: 'ç¬¬1é€± (9/28-10/4)',
    days: [...],
    shifts: {
      company: { start: {...}, end: {...} },
      sidejob: { start: {...}, end: {...} }
    }
  }
])

// ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—ï¼ˆäºŒé‡ãƒã‚§ãƒƒã‚¯å¯¾å¿œï¼‰
const weeklyCalculations = computed(() => {
  return weeks.value.map(week => {
    const companyHours = calculateHours(week.shifts.company)
    const sidejobHours = calculateHours(week.shifts.sidejob)
    const totalHours = companyHours + sidejobHours

    return {
      companyHours,
      sidejobHours,
      totalHours,
      violations: {
        companyExceeded: companyHours > 20,
        totalExceeded: totalHours > 40,
        hasAnyViolation: companyHours > 20 || totalHours > 40
      },
      warningMessages: [
        ...(companyHours > 20 ? ['å¼Šç¤¾20æ™‚é–“åˆ¶é™è¶…é'] : []),
        ...(totalHours > 40 ? ['é€±40æ™‚é–“åˆ¶é™è¶…é'] : [])
      ]
    }
  })
})
```

### 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆRailsï¼‰

#### 2.1 é€±ä¸­å¿ƒãƒ¢ãƒ‡ãƒ«è¨­è¨ˆ
```ruby
class Week < ApplicationRecord
  has_many :weekly_shifts, dependent: :destroy
  has_many :users, through: :weekly_shifts

  validates :start_date, :end_date, presence: true
  validates :start_date, uniqueness: true

  scope :for_month, ->(year, month) {
    month_start = Date.new(year, month, 1)
    month_end = month_start.end_of_month
    where('start_date <= ? AND end_date >= ?', month_end, month_start)
  }

  # é€±ç•ªå·è¨ˆç®—
  def week_number
    start_date.cweek
  end

  # æœˆè·¨ãåˆ¤å®š
  def cross_month?
    start_date.month != end_date.month
  end
end

class WeeklyShift < ApplicationRecord
  belongs_to :user
  belongs_to :week
  has_many :daily_schedules, dependent: :destroy

  enum status: { draft: 0, submitted: 1 }

  # é€±é–“åŠ´åƒæ™‚é–“è¨ˆç®—ï¼ˆæœˆè·¨ãå¯¾å¿œï¼‰
  def calculate_weekly_hours
    current_month_hours = calculate_current_month_hours
    previous_month_hours = fetch_previous_month_hours

    {
      company: current_month_hours[:company] + previous_month_hours[:company],
      sidejob: current_month_hours[:sidejob] + previous_month_hours[:sidejob],
      total: current_month_hours[:total] + previous_month_hours[:total],
      breakdown: {
        current_month: current_month_hours,
        previous_month: previous_month_hours
      }
    }
  end

  # å½“æœˆåˆ†æ™‚é–“è¨ˆç®—
  def calculate_current_month_hours
    target_month_schedules = daily_schedules.where(
      date: Date.new(submission_year, submission_month, 1)..Date.new(submission_year, submission_month, 1).end_of_month
    )

    company_hours = target_month_schedules.sum(&:company_actual_hours)
    sidejob_hours = target_month_schedules.sum(&:sidejob_actual_hours)

    {
      company: company_hours,
      sidejob: sidejob_hours,
      total: company_hours + sidejob_hours
    }
  end

  # å‰æœˆç¢ºå®šãƒ‡ãƒ¼ã‚¿ã®å–å¾—
  def fetch_previous_month_hours
    return { company: 0, sidejob: 0, total: 0 } unless week.cross_month?

    previous_month_date = Date.new(submission_year, submission_month, 1) - 1.month
    previous_weekly_shift = user.weekly_shifts
                               .joins(:week)
                               .where(weeks: { start_date: week.start_date })
                               .where(submission_year: previous_month_date.year,
                                     submission_month: previous_month_date.month,
                                     status: [:confirmed, :approved])
                               .first

    return { company: 0, sidejob: 0, total: 0 } unless previous_weekly_shift

    # å‰æœˆã«å±ã™ã‚‹æ—¥ä»˜ã®ã¿é›†è¨ˆ
    month_end = Date.new(submission_year, submission_month, 1) - 1.day
    target_dates = (week.start_date..week.end_date).select { |d| d <= month_end }

    previous_schedules = previous_weekly_shift.daily_schedules.where(date: target_dates)
    company_hours = previous_schedules.sum(&:company_actual_hours)
    sidejob_hours = previous_schedules.sum(&:sidejob_actual_hours)

    {
      company: company_hours,
      sidejob: sidejob_hours,
      total: company_hours + sidejob_hours
    }
  end

  # åˆ¶é™é•åãƒã‚§ãƒƒã‚¯ï¼ˆäºŒé‡ãƒã‚§ãƒƒã‚¯ï¼‰
  def check_violations
    weekly_hours = calculate_weekly_hours
    violations = []

    # å¼Šç¤¾20æ™‚é–“åˆ¶é™ãƒã‚§ãƒƒã‚¯
    if weekly_hours[:company] > 20
      violations << {
        type: 'company_hours_exceeded',
        limit: 20,
        actual: weekly_hours[:company],
        message: 'å¼Šç¤¾ã§ã®é€±20æ™‚é–“åˆ¶é™ã‚’è¶…é'
      }
    end

    # åˆè¨ˆ40æ™‚é–“åˆ¶é™ãƒã‚§ãƒƒã‚¯
    if weekly_hours[:total] > 40
      violations << {
        type: 'total_hours_exceeded',
        limit: 40,
        actual: weekly_hours[:total],
        message: 'é€±40æ™‚é–“åˆ¶é™ã‚’è¶…éï¼ˆå¼Šç¤¾+æ›ã‘æŒã¡ï¼‰'
      }
    end

    if violations.any?
      self.violation_warnings = [{
        week_id: week.id,
        week_start: week.start_date,
        week_end: week.end_date,
        company_hours: weekly_hours[:company],
        sidejob_hours: weekly_hours[:sidejob],
        total_hours: weekly_hours[:total],
        previous_month_hours: weekly_hours[:breakdown][:previous_month],
        current_month_hours: weekly_hours[:breakdown][:current_month],
        violations: violations
      }].to_json
    else
      self.violation_warnings = nil
    end
  end
end

class DailySchedule < ApplicationRecord
  belongs_to :weekly_shift

  validates :date, presence: true
  validates :date, uniqueness: { scope: :weekly_shift_id }

  # å¼Šç¤¾å®ŸåŠ´åƒæ™‚é–“è¨ˆç®—
  def company_actual_hours
    return 0 unless is_company_working && company_start_time && company_end_time

    total_minutes = time_diff_in_minutes(company_start_time, company_end_time)
    break_minutes = total_minutes >= 360 ? 60 : 0  # 6æ™‚é–“ä»¥ä¸Šãªã‚‰1æ™‚é–“ä¼‘æ†©

    (total_minutes - break_minutes) / 60.0
  end

  # æ›ã‘æŒã¡å®ŸåŠ´åƒæ™‚é–“è¨ˆç®—
  def sidejob_actual_hours
    return 0 unless is_sidejob_working && sidejob_start_time && sidejob_end_time

    total_minutes = time_diff_in_minutes(sidejob_start_time, sidejob_end_time)
    break_minutes = total_minutes >= 360 ? 60 : 0

    (total_minutes - break_minutes) / 60.0
  end

  private

  # HH:MMå½¢å¼ã®æ–‡å­—åˆ—ã‹ã‚‰æ™‚é–“å·®ã‚’åˆ†å˜ä½ã§è¨ˆç®—
  def time_diff_in_minutes(start_str, end_str)
    start_parts = start_str.split(':').map(&:to_i)
    end_parts = end_str.split(':').map(&:to_i)

    start_minutes = start_parts[0] * 60 + start_parts[1]
    end_minutes = end_parts[0] * 60 + end_parts[1]

    end_minutes - start_minutes
  end
end

class MonthlySummary < ApplicationRecord
  belongs_to :user

  enum status: { draft: 0, submitted: 1 }

  validates :year, :month, presence: true
  validates :month, uniqueness: { scope: [:user_id, :year] }

  # æœˆæ¬¡é›†è¨ˆã®æ›´æ–°
  def update_summary
    weekly_shifts = user.weekly_shifts
                       .where(submission_year: year, submission_month: month)

    self.total_company_hours = weekly_shifts.sum { |ws| ws.calculate_current_month_hours[:company] }
    self.total_sidejob_hours = weekly_shifts.sum { |ws| ws.calculate_current_month_hours[:sidejob] }
    self.total_all_hours = total_company_hours + total_sidejob_hours
    save!
  end
end
```

#### 2.2 é€±ä¸­å¿ƒ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
```ruby
# routes.rb
resources :monthly_summaries, only: [:index, :show] do
  member do
    patch :submit
  end
end

resources :weekly_shifts, only: [:show, :edit, :update] do
  member do
    patch :save_draft
    patch :submit_shift
    patch :back_to_draft  # å†ç·¨é›†ã®ãŸã‚
  end
  resources :daily_schedules, only: [:update]
end

# æœˆæŒ‡å®šã§ã®ã‚·ãƒ•ãƒˆè¡¨ç¤ºãƒ»ä½œæˆ
get 'shifts/:year/:month', to: 'monthly_summaries#show_month', as: :shift_month
get 'shifts/:year/:month/new', to: 'monthly_summaries#new_month', as: :new_shift_month

# monthly_summaries_controller.rb
class MonthlySummariesController < ApplicationController
  def show_month
    @year, @month = params[:year].to_i, params[:month].to_i
    @summary = current_user.monthly_summaries
                          .find_or_create_by(year: @year, month: @month)

    @weeks = Week.for_month(@year, @month)
    @weekly_shifts = load_weekly_shifts_for_month(@year, @month)

    render json: {
      summary: @summary,
      weeks: @weeks,
      weekly_shifts: @weekly_shifts.map(&:as_json_with_schedules),
      editable: editable_month?(@year, @month)
    }
  end

  def submit
    @summary = current_user.monthly_summaries.find(params[:id])

    # å…¨é€±ã®åˆ¶é™ãƒã‚§ãƒƒã‚¯
    weekly_shifts = current_user.weekly_shifts
                               .where(submission_year: @summary.year,
                                     submission_month: @summary.month)

    violations = []
    weekly_shifts.each do |ws|
      ws.check_violations
      if ws.violation_warnings.present?
        violations.concat(JSON.parse(ws.violation_warnings))
      end
    end

    if violations.any?
      render json: {
        status: 'violations_found',
        violations: violations
      }
    else
      @summary.update!(status: :submitted)
      weekly_shifts.update_all(status: :submitted, submitted_at: Time.current)
      render json: { status: 'submitted' }
    end
  end

  private

  def load_weekly_shifts_for_month(year, month)
    weeks = Week.for_month(year, month)
    current_user.weekly_shifts
               .includes(:daily_schedules)
               .where(week: weeks, submission_year: year, submission_month: month)
               .or(
                 current_user.weekly_shifts
                            .includes(:daily_schedules)
                            .where(week: weeks)
                            .where(submission_year: year - (month == 1 ? 1 : 0),
                                  submission_month: month == 1 ? 12 : month - 1,
                                  status: [:confirmed, :approved])
               )
  end

  def editable_month?(year, month)
    target_date = Date.new(year, month, 1)
    target_date > Date.current.beginning_of_month
  end
end

# weekly_shifts_controller.rb
class WeeklyShiftsController < ApplicationController
  def update
    @weekly_shift = current_user.weekly_shifts.find(params[:id])

    if @weekly_shift.update(weekly_shift_params)
      @weekly_shift.check_violations
      render json: {
        status: 'success',
        weekly_shift: @weekly_shift.as_json_with_schedules,
        violations: @weekly_shift.violation_warnings
      }
    else
      render json: { status: 'error', errors: @weekly_shift.errors }
    end
  end

  def save_draft
    @weekly_shift = current_user.weekly_shifts.find(params[:id])
    @weekly_shift.update!(status: :draft)
    render json: { status: 'draft_saved' }
  end

  def submit_shift
    @weekly_shift = current_user.weekly_shifts.find(params[:id])
    @weekly_shift.check_violations

    if @weekly_shift.violation_warnings.present?
      render json: {
        status: 'violations_found',
        violations: JSON.parse(@weekly_shift.violation_warnings)
      }
    else
      @weekly_shift.update!(status: :submitted, submitted_at: Time.current)
      render json: { status: 'submitted' }
    end
  end
end
```

## ğŸ“Š ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«

### 1. åŠ´åƒæ™‚é–“åˆ¶é™
- **é€±20æ™‚é–“åˆ¶é™**: å¼Šç¤¾ã§ã®å®ŸåŠ´åƒæ™‚é–“ï¼ˆä¼‘æ†©é™¤ãï¼‰â€»å­¦ç”Ÿãƒã‚¤ãƒˆæ³•çš„åˆ¶é™
- **é€±40æ™‚é–“åˆ¶é™**: å¼Šç¤¾ + æ›ã‘æŒã¡ã®åˆè¨ˆå®ŸåŠ´åƒæ™‚é–“ â€»åŠ´åƒåŸºæº–æ³•åˆ¶é™
- **äºŒé‡ãƒã‚§ãƒƒã‚¯**: ä¸¡åˆ¶é™ã‚’ç‹¬ç«‹ã—ã¦æ¤œè¨¼ã—ã€ã©ã¡ã‚‰ã‹ä¸€æ–¹ã§ã‚‚è¶…éãªã‚‰è­¦å‘Š
- **ä¼‘æ†©æ™‚é–“**: 6æ™‚é–“ä»¥ä¸Šå‹¤å‹™ã®å ´åˆã€1æ™‚é–“ã®ä¼‘æ†©ã‚’è‡ªå‹•å·®ã—å¼•ã

### 2. é€±ã®å®šç¾©
- **é€±ã®é–‹å§‹**: æœˆæ›œæ—¥é–‹å§‹ï¼ˆæœˆã€œæ—¥ã®7æ—¥é–“ï¼‰
- **æœˆè·¨ã**: å‰æœˆç¢ºå®šãƒ‡ãƒ¼ã‚¿ + å½“æœˆå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã§é€±åˆ¶é™ãƒã‚§ãƒƒã‚¯
- **è¨ˆç®—ç¯„å›²**: é€±ã«å«ã¾ã‚Œã‚‹å…¨æ—¥ç¨‹ï¼ˆæœˆè·¨ãå«ã‚€ï¼‰

### 3. æå‡ºãƒ»å†ç·¨é›†ãƒ•ãƒ­ãƒ¼
```
draft â†’ submitted
  â†‘        â†“
  â””â”€â”€ å†ç·¨é›†å¯èƒ½ï¼ˆå­¦æ¥­å„ªå…ˆã®ãŸã‚åˆ¶é™å†…ã§ã‚ã‚Œã°ä½•åº¦ã§ã‚‚å¤‰æ›´å¯ï¼‰
```

**æ‰¿èªä¸è¦ã®ç†ç”±**:
- é€±20æ™‚é–“/40æ™‚é–“åˆ¶é™ã¯å…¨ã¦ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ä¿è¨¼æ¸ˆã¿
- ã‚·ãƒ•ãƒˆå¸Œæœ›ã¯å­¦ç”Ÿã®ã€Œå¸Œæœ›ã€ã§ã‚ã‚Šã€ç¢ºå®šã§ã¯ãªã„
- å­¦æ¥­ã‚’å„ªå…ˆã—ã¦ã‚·ãƒ•ãƒˆã‚’æ¸›ã‚‰ã™ã“ã¨ã‚’æ¨å¥¨
- å®Ÿéš›ã®å‹¤å‹™ã¯å‹¤æ€ ç™»éŒ²ã§åˆ¥é€”ç®¡ç†ãƒ»æ‰¿èªã•ã‚Œã‚‹

## âœ… å—ã‘å…¥ã‚Œæ¡ä»¶

### æ©Ÿèƒ½é¢
- [ ] æœˆé–“5é€±åˆ†ã®ã‚·ãƒ•ãƒˆå…¥åŠ›ãŒå¯èƒ½
- [ ] å¼Šç¤¾ãƒ»æ›ã‘æŒã¡ã®æ™‚é–“ã‚’å€‹åˆ¥å…¥åŠ›å¯èƒ½
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§é€±é–“åŠ´åƒæ™‚é–“ã‚’è¨ˆç®—ãƒ»è¡¨ç¤º
- [ ] åˆ¶é™è¶…éæ™‚ã®è¦–è¦šçš„è­¦å‘Šè¡¨ç¤º
- [ ] åˆ¶é™è¶…éæ™‚ã®æå‡ºãƒ–ãƒ­ãƒƒã‚¯
- [ ] ä¸‹æ›¸ãä¿å­˜ãƒ»å¾©å…ƒæ©Ÿèƒ½
- [ ] æå‡ºå¾Œã‚‚å†ç·¨é›†å¯èƒ½ãªåˆ¶å¾¡

### æŠ€è¡“é¢
- [ ] Vue.js ã§ã®ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãª UI
- [ ] Rails API ã§ã®åˆ¶é™ãƒã‚§ãƒƒã‚¯
- [ ] PostgreSQL ã§ã®åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿ä¿å­˜
- [ ] æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã®æœ‰åŠ¹æ´»ç”¨

### UXé¢
- [ ] ç›´æ„Ÿçš„ãªæ™‚é–“å…¥åŠ›ï¼ˆHTML5 time inputï¼‰
- [ ] é€±å˜ä½ã§ã®åˆ¶é™çŠ¶æ³ã®å¯è¦–åŒ–
- [ ] ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®åˆ†ã‹ã‚Šã‚„ã™ã„è¡¨ç¤º
- [ ] æå‡ºå‰ã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°

## ğŸ“‹ å®Ÿè£…å„ªå…ˆåº¦

### Phase 1: åŸºæœ¬æ©Ÿèƒ½
1. Vue.js ã§ã®ã‚·ãƒ•ãƒˆå…¥åŠ› UI
2. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ™‚é–“è¨ˆç®—
3. åŸºæœ¬çš„ãªåˆ¶é™ãƒã‚§ãƒƒã‚¯

### Phase 2: ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
1. Rails API ã§ã®ä¿å­˜æ©Ÿèƒ½
2. ä¸‹æ›¸ãä¿å­˜ãƒ»å¾©å…ƒ
3. æå‡ºçŠ¶æ…‹ç®¡ç†

### Phase 3: é«˜åº¦ãªæ©Ÿèƒ½
1. è©³ç´°ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
2. ä¸€æ‹¬å…¥åŠ›æ©Ÿèƒ½
3. ~~æ‰¿èªãƒ•ãƒ­ãƒ¼é€£æº~~ï¼ˆä¸è¦ - ã‚·ãƒ•ãƒˆå¸Œæœ›ã¯æ‰¿èªå¯¾è±¡å¤–ï¼‰

## ğŸ“š å‚è€ƒè³‡æ–™

- [ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼](./ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼.md)
- [ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«](../design/03-shift-request-simple.html)
- [ERå›³](../design/er_diagram.html)

## ğŸ†• é€±ä¸­å¿ƒè¨­è¨ˆã«ã‚ˆã‚‹é«˜åº¦ãªæ©Ÿèƒ½

### 1. ã‚·ãƒ³ãƒ—ãƒ«ãªçŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

#### 1.1 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
- **draft**: ä¸‹æ›¸ãçŠ¶æ…‹ï¼ˆç·¨é›†ä¸­ï¼‰
- **submitted**: æå‡ºæ¸ˆã¿çŠ¶æ…‹ï¼ˆåˆ¶é™å†…ã§ã‚ã‚Œã°ä½•åº¦ã§ã‚‚å†ç·¨é›†å¯èƒ½ï¼‰

#### 1.2 å†ç·¨é›†ã®è‡ªç”±åº¦
```ruby
# å­¦æ¥­å„ªå…ˆã®ãŸã‚ã€æå‡ºå¾Œã‚‚åˆ¶é™å†…ã§ã‚ã‚Œã°è‡ªç”±ã«ç·¨é›†å¯èƒ½
class WeeklyShift
  # æå‡ºæ¸ˆã¿ã§ã‚‚ä¸‹æ›¸ãã«æˆ»ã›ã‚‹
  def back_to_draft
    update!(status: :draft)
  end

  # å†æå‡º
  def resubmit
    update!(status: :submitted, submitted_at: Time.current)
  end
end
```

### 2. æœˆç®¡ç†æ©Ÿèƒ½ã®å¼·åŒ–

#### 2.1 åŸºæœ¬ãƒ«ãƒ¼ãƒ«
- **å¯¾è±¡æœˆ**: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã¯ã€Œä»Šæœˆã€ã®ã‚·ãƒ•ãƒˆä½œæˆãƒ»ç·¨é›†
- **æœˆç§»å‹•**: ã‚·ãƒ•ãƒˆç”»é¢ã§å‰å¾Œæœˆã¸ã®ç§»å‹•ãƒœã‚¿ãƒ³
- **ç·¨é›†åˆ¶é™**:
  - éå»æœˆ: ç·¨é›†ä¸å¯ï¼ˆç¢ºå®šæ¸ˆã¿ï¼‰
  - å½“æœˆãƒ»æ¥æœˆä»¥é™: ç·¨é›†ãƒ»ä¿å­˜å¯èƒ½ï¼ˆå­¦æ¥­å„ªå…ˆã®ãŸã‚æŸ”è»Ÿã«å¤‰æ›´å¯èƒ½ï¼‰

#### 2.2 è¡¨ç¤ºåˆ¶å¾¡
```ruby
# ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ã®åˆ¶å¾¡ä¾‹
def editable?
  target_date = Date.new(year, month, 1)
  target_date >= Date.current.beginning_of_month
end
```

### 2. é€±ä¸­å¿ƒè¨­è¨ˆã«ã‚ˆã‚‹æœˆè·¨ãå¯¾å¿œ

#### 2.1 é€±ã®å®šç¾©ã¨ç®¡ç†
- **é€±å˜ä½**: æœˆæ›œæ—¥ã€œæ—¥æ›œæ—¥ï¼ˆISO 8601æº–æ‹ ï¼‰
- **é€±ãƒ†ãƒ¼ãƒ–ãƒ«**: å…¨ã¦ã®é€±ã‚’äº‹å‰ã«`Week`ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç®¡ç†
- **æœˆè·¨ãå‡¦ç†**: é€±å˜ä½ã§è‡ªç„¶ã«æœˆå¢ƒç•Œã‚’æ‰±ã†

#### 2.2 æœˆè·¨ãé€±ã®ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆ
```ruby
# ä¾‹: 2025å¹´11æœˆã®ã‚·ãƒ•ãƒˆä½œæˆæ™‚ï¼ˆç¬¬44é€±: 10/27-11/2ï¼‰
#
# Week ãƒ†ãƒ¼ãƒ–ãƒ«:
# id: 44, start_date: '2025-10-27', end_date: '2025-11-02', is_cross_month: true
#
# WeeklyShift ãƒ†ãƒ¼ãƒ–ãƒ«:
# 10æœˆæå‡ºåˆ†: week_id: 44, submission_year: 2025, submission_month: 10, status: 'approved'
# 11æœˆæå‡ºåˆ†: week_id: 44, submission_year: 2025, submission_month: 11, status: 'draft'
#
# DailySchedule ãƒ†ãƒ¼ãƒ–ãƒ«:
# 10æœˆåˆ†: dates: ['2025-10-27', '2025-10-28', '2025-10-29', '2025-10-30', '2025-10-31']
# 11æœˆåˆ†: dates: ['2025-11-01', '2025-11-02']
```

#### 2.3 åˆ¶é™ãƒã‚§ãƒƒã‚¯ã®çµ±åˆ
```ruby
# 11æœˆã‚·ãƒ•ãƒˆå…¥åŠ›æ™‚ã®é€±40æ™‚é–“åˆ¶é™ãƒã‚§ãƒƒã‚¯
def calculate_week_44_hours
  # 10æœˆç¢ºå®šåˆ†
  oct_weekly_shift = user.weekly_shifts
                        .where(week_id: 44, submission_month: 10,
                               status: [:confirmed, :approved])
                        .first
  oct_hours = oct_weekly_shift&.calculate_current_month_hours || {company: 0, sidejob: 0}

  # 11æœˆå…¥åŠ›åˆ†
  nov_weekly_shift = user.weekly_shifts
                        .where(week_id: 44, submission_month: 11)
                        .first
  nov_hours = nov_weekly_shift&.calculate_current_month_hours || {company: 0, sidejob: 0}

  # é€±åˆè¨ˆ
  {
    company: oct_hours[:company] + nov_hours[:company],
    sidejob: oct_hours[:sidejob] + nov_hours[:sidejob],
    total: (oct_hours[:company] + oct_hours[:sidejob]) +
           (nov_hours[:company] + nov_hours[:sidejob])
  }
end
```

#### 2.4 UIè¡¨ç¤ºã§ã®å‰æœˆãƒ‡ãƒ¼ã‚¿ç¶™æ‰¿
- **å‰æœˆãƒ‡ãƒ¼ã‚¿**: `status: [:confirmed, :approved]` ã® WeeklyShift ã‚’å‚ç…§
- **è¡¨ç¤ºå½¢å¼**: ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ + ç·¨é›†ä¸å¯ãƒãƒ¼ã‚«ãƒ¼
- **è¨ˆç®—å¯¾è±¡**: é€±åˆ¶é™ãƒã‚§ãƒƒã‚¯ã«ã¯å«ã‚ã‚‹
- **ãƒ‡ãƒ¼ã‚¿æ›´æ–°**: å‰æœˆãƒ‡ãƒ¼ã‚¿ã¯å¤‰æ›´ä¸å¯ã€å½“æœˆãƒ‡ãƒ¼ã‚¿ã®ã¿ç·¨é›†å¯èƒ½

### 3. åœŸæ—¥å‹¤å‹™åˆ¶é™

#### 3.1 åŸºæœ¬åˆ¶ç´„
- **å¹³æ—¥ã®ã¿**: æœˆã€œé‡‘æ›œæ—¥ã®å…¥åŠ›ã‚’è¨±å¯
- **åœŸæ—¥åˆ¶é™**: å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç„¡åŠ¹åŒ–
- **ä¾‹å¤–å‡¦ç†**: ç®¡ç†è€…æ¨©é™ã§ã®ç‰¹åˆ¥å¯¾å¿œï¼ˆå°†æ¥æ‹¡å¼µï¼‰

#### 3.2 UIåˆ¶å¾¡
```javascript
// Vue.js ã§ã®åˆ¶å¾¡
const isWeekend = (date) => {
  const dayOfWeek = date.getDay()
  return dayOfWeek === 0 || dayOfWeek === 6  // æ—¥æ›œ=0, åœŸæ›œ=6
}

const isEditable = (date) => {
  return !isWeekend(date) && isInEditableMonth(date)
}
```

---

## ğŸš¨ å®Ÿè£…æ™‚ã®æ­£ã—ã„èªè­˜ï¼ˆé‡è¦ï¼‰

### å®Ÿéš›ã®ä»•æ§˜ã¨èªè­˜é•ã„

#### âŒ é–“é•ã£ãŸèªè­˜ï¼ˆClaudeå®Ÿè£…æ™‚ï¼‰
- æ–°ã—ã„ `/monthly_summaries` ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’ä½œæˆ
- å¤§é‡ã®æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã€ãƒ“ãƒ¥ãƒ¼ã‚’è¿½åŠ 
- æ—¢å­˜ã®ãƒ•ãƒ­ãƒ¼ã‚’ç„¡è¦–ã—ãŸç‹¬è‡ªã‚·ã‚¹ãƒ†ãƒ 

#### âœ… æ­£ã—ã„èªè­˜
- **æ—¢å­˜ã®ãƒšãƒ¼ã‚¸**: `http://localhost:3000/shift_requests/new`
- **æ—¢å­˜ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼**: `ShiftRequestsController`
- **æ—¢å­˜ã®ãƒ“ãƒ¥ãƒ¼**: `app/views/shift_requests/new.html.erb`
- **å®Ÿè£…å¯¾è±¡**: ã“ã®æ—¢å­˜ãƒšãƒ¼ã‚¸ã®Vue.jsã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ”¹å–„ã®ã¿

### æ­£ã—ã„å®Ÿè£…ç¯„å›²

#### ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã®ã¿ï¼‰
```
app/views/shift_requests/new.html.erb    # æ—¢å­˜ãƒ“ãƒ¥ãƒ¼ã®ä¿®æ­£
frontend/components/ShiftRequestForm.vue # Vue.jsã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ”¹å–„
frontend/components/WeekShiftInput.vue   # é€±å˜ä½å…¥åŠ›ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
app/controllers/shift_requests_controller.rb # å¿…è¦æœ€å°é™ã®ä¿®æ­£
```

#### æ–°è¦ä½œæˆä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«
```
âŒ app/controllers/monthly_summaries_controller.rb
âŒ app/models/monthly_summary.rb
âŒ app/models/weekly_shift.rb
âŒ app/models/week.rb
âŒ app/models/daily_schedule.rb
âŒ db/migrate/20251005* (å…¨ã¦ã®æ–°è¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)
âŒ app/views/monthly_summaries/**/*
âŒ app/views/weekly_shifts/**/*
âŒ lib/tasks/weeks.rake
âŒ lib/tasks/migration_support.rake
âŒ ãã®ä»–ã®é€±ä¸­å¿ƒè¨­è¨ˆãƒ•ã‚¡ã‚¤ãƒ«ç¾¤
```

### æ­£ã—ã„ãƒ•ãƒ­ãƒ¼
1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ã€Œã‚·ãƒ•ãƒˆå¸Œæœ›æå‡ºã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
2. `http://localhost:3000/shift_requests/new` ã«é·ç§»
3. æ—¢å­˜ã® Vue.js ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ”¹å–„ã•ã‚ŒãŸ UI ã‚’è¡¨ç¤º
4. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ™‚é–“è¨ˆç®—ãƒ»åˆ¶é™ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
5. æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã‚’ä½¿ç”¨ã—ãŸä¿å­˜

### é€±ä¸­å¿ƒè¨­è¨ˆã«ã¤ã„ã¦
- **ä»•æ§˜æ›¸ã§ã®è­°è«–**: å°†æ¥çš„ãªæ”¹å–„æ¡ˆã¨ã—ã¦æœ‰åŠ¹
- **ç¾åœ¨ã®å®Ÿè£…**: æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®æ”¹å–„ã«ã¨ã©ã‚ã‚‹
- **æ®µéšçš„ç§»è¡Œ**: å°†æ¥ã®ãƒ•ã‚§ãƒ¼ã‚ºã§æ¤œè¨

### ç·Šæ€¥å¯¾å¿œ
ç¾åœ¨å¤§é‡ã®ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã®ãŸã‚ã€ä»¥ä¸‹ã‚’å®Ÿæ–½ï¼š
1. ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤
2. æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã‚’å…ƒã«æˆ»ã™
3. æœ¬æ¥ã® `shift_requests/new` ãƒšãƒ¼ã‚¸æ”¹å–„ã«é›†ä¸­

---

## ğŸ”Œ APIè¨­è¨ˆ (ãƒ¢ãƒƒã‚¯ã‹ã‚‰APIåŒ–)

### 1. APIæ¦‚è¦

ç¾åœ¨ã®Vue.jsã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯é™çš„ãªãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã®é€£æºã®ãŸã‚APIåŒ–ã‚’è¡Œã†ã€‚

### 2. APIä»•æ§˜

#### 2.1 é€±ãƒ‡ãƒ¼ã‚¿å–å¾—API

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/shift_requests/weeks`

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
```json
{
  "year": 2025,
  "month": 10
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "status": "success",
  "data": {
    "weeks": [
      {
        "id": 1,
        "title": "ç¬¬1é€± (9/28-10/4)",
        "start_date": "2025-09-28",
        "end_date": "2025-10-04",
        "is_cross_month": true,
        "days_in_month": 4,
        "days": [
          {
            "key": "mon",
            "label": "æœˆ 9/30",
            "date": "2025-09-30",
            "in_target_month": false
          },
          {
            "key": "tue",
            "label": "ç« 10/1",
            "date": "2025-10-01",
            "in_target_month": true
          }
        ]
      }
    ],
    "target_year": 2025,
    "target_month": 10,
    "editable": true
  }
}
```

#### 2.2 æ—¢å­˜ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿å–å¾—API

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/shift_requests/existing`

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
```json
{
  "year": 2025,
  "month": 10
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "status": "success",
  "data": {
    "shifts": {
      "week_1": {
        "company": {
          "start": {
            "mon": "",
            "tue": "",
            "wed": "",
            "thu": "",
            "fri": "09:00",
            "sat": "",
            "sun": ""
          },
          "end": {
            "mon": "",
            "tue": "",
            "wed": "",
            "thu": "",
            "fri": "16:00",
            "sat": "",
            "sun": ""
          }
        },
        "sidejob": {
          "start": {
            "tue": "18:00",
            "thu": "18:00"
          },
          "end": {
            "tue": "22:00",
            "thu": "22:00"
          }
        }
      }
    },
    "status": "draft",
    "last_saved": "2025-10-05T12:30:00Z"
  }
}
```

#### 2.3 ã‚·ãƒ•ãƒˆä¿å­˜APIï¼ˆä¸‹æ›¸ãï¼‰

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/shift_requests/save_draft`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:
```json
{
  "year": 2025,
  "month": 10,
  "shifts": {
    "week_1": {
      "company": {
        "start": {
          "mon": "09:00",
          "tue": "",
          "wed": "09:00",
          "thu": "",
          "fri": "09:00",
          "sat": "",
          "sun": ""
        },
        "end": {
          "mon": "16:00",
          "tue": "",
          "wed": "16:00",
          "thu": "",
          "fri": "16:00",
          "sat": "",
          "sun": ""
        }
      },
      "sidejob": {
        "start": {
          "tue": "18:00",
          "thu": "18:00"
        },
        "end": {
          "tue": "22:00",
          "thu": "22:00"
        }
      }
    }
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "status": "success",
  "message": "ä¸‹æ›¸ãã‚’ä¿å­˜ã—ã¾ã—ãŸ",
  "data": {
    "saved_at": "2025-10-05T12:35:00Z",
    "validation_results": [
      {
        "week_id": 1,
        "week_title": "ç¬¬1é€± (9/28-10/4)",
        "company_hours": 21.0,
        "sidejob_hours": 8.0,
        "total_hours": 29.0,
        "violations": [
          {
            "type": "company_hours_exceeded",
            "limit": 20,
            "actual": 21.0,
            "message": "å¼Šç¤¾ã§ã®é€±20æ™‚é–“åˆ¶é™ã‚’è¶…é"
          }
        ]
      }
    ]
  }
}
```

#### 2.4 ã‚·ãƒ•ãƒˆæå‡ºAPI

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/shift_requests/submit`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:
```json
{
  "year": 2025,
  "month": 10,
  "shifts": {
    // 2.3ã¨åŒã˜å½¢å¼
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸæ™‚ï¼‰**:
```json
{
  "status": "success",
  "message": "ã‚·ãƒ•ãƒˆã‚’æå‡ºã—ã¾ã—ãŸ",
  "data": {
    "submitted_at": "2025-10-05T12:40:00Z",
    "submission_id": "shift_2025_10_user_123"
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆåˆ¶é™é•åæ™‚ï¼‰**:
```json
{
  "status": "violation_error",
  "message": "åŠ´åƒæ™‚é–“åˆ¶é™ã«é•åãŒã‚ã‚Šã¾ã™",
  "errors": [
    {
      "week_id": 1,
      "week_title": "ç¬¬1é€± (9/28-10/4)",
      "violations": [
        {
          "type": "company_hours_exceeded",
          "limit": 20,
          "actual": 22.0,
          "message": "å¼Šç¤¾ã§ã®é€±20æ™‚é–“åˆ¶é™ã‚’è¶…é"
        },
        {
          "type": "total_hours_exceeded",
          "limit": 40,
          "actual": 45.0,
          "message": "é€±40æ™‚é–“åˆ¶é™ã‚’è¶…éï¼ˆå¼Šç¤¾+æ›ã‘æŒã¡ï¼‰"
        }
      ]
    }
  ]
}
```

#### 2.5 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼API

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/shift_requests/validate`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:
```json
{
  "week_shifts": {
    "week_1": {
      "company": {
        "start": {"mon": "09:00", "fri": "09:00"},
        "end": {"mon": "16:00", "fri": "16:00"}
      },
      "sidejob": {
        "start": {"tue": "18:00"},
        "end": {"tue": "22:00"}
      }
    }
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "status": "success",
  "data": {
    "validations": [
      {
        "week_id": 1,
        "company_hours": 14.0,
        "sidejob_hours": 4.0,
        "total_hours": 18.0,
        "company_violation": false,
        "total_violation": false,
        "messages": []
      }
    ],
    "overall_valid": true
  }
}
```

### 3. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å®Ÿè£…

#### 3.1 APIå°‚ç”¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ä½œæˆ

```ruby
# app/controllers/api/shift_requests_controller.rb
class Api::ShiftRequestsController < ApplicationController
  before_action :authenticate_user!

  def weeks
    year = params[:year].to_i
    month = params[:month].to_i

    weeks_data = generate_weeks_for_month(year, month)

    render json: {
      status: 'success',
      data: {
        weeks: weeks_data,
        target_year: year,
        target_month: month,
        editable: editable_month?(year, month)
      }
    }
  end

  def existing
    year = params[:year].to_i
    month = params[:month].to_i

    # æ—¢å­˜ã®ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    existing_shifts = load_existing_shifts(year, month)

    render json: {
      status: 'success',
      data: {
        shifts: existing_shifts,
        status: 'draft', # TODO: å®Ÿéš›ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
        last_saved: Time.current.iso8601
      }
    }
  end

  def save_draft
    year = params[:year].to_i
    month = params[:month].to_i
    shifts_data = params[:shifts]

    # ä¸‹æ›¸ãä¿å­˜å‡¦ç†
    result = save_shifts_as_draft(year, month, shifts_data)
    validation_results = validate_shifts(shifts_data)

    render json: {
      status: 'success',
      message: 'ä¸‹æ›¸ãã‚’ä¿å­˜ã—ã¾ã—ãŸ',
      data: {
        saved_at: Time.current.iso8601,
        validation_results: validation_results
      }
    }
  end

  def submit
    year = params[:year].to_i
    month = params[:month].to_i
    shifts_data = params[:shifts]

    # æœ€çµ‚æ¤œè¨¼
    validation_results = validate_shifts(shifts_data)
    violations = validation_results.select { |r| r[:violations].any? }

    if violations.any?
      render json: {
        status: 'violation_error',
        message: 'åŠ´åƒæ™‚é–“åˆ¶é™ã«é•åãŒã‚ã‚Šã¾ã™',
        errors: violations
      }
    else
      # æå‡ºå‡¦ç†
      submit_shifts(year, month, shifts_data)

      render json: {
        status: 'success',
        message: 'ã‚·ãƒ•ãƒˆã‚’æå‡ºã—ã¾ã—ãŸ',
        data: {
          submitted_at: Time.current.iso8601,
          submission_id: "shift_#{year}_#{month}_user_#{current_user.id}"
        }
      }
    end
  end

  def validate
    shifts_data = params[:week_shifts]
    validation_results = validate_shifts(shifts_data)

    render json: {
      status: 'success',
      data: {
        validations: validation_results,
        overall_valid: validation_results.all? { |r| r[:violations].empty? }
      }
    }
  end

  private

  def generate_weeks_for_month(year, month)
    # æœˆã®é€±ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
    # TODO: å®Ÿè£…è©³ç´°
    [
      {
        id: 1,
        title: "ç¬¬1é€± (9/28-10/4)",
        start_date: "2025-09-28",
        end_date: "2025-10-04",
        is_cross_month: true,
        days_in_month: 4,
        days: [
          {
            key: "mon",
            label: "æœˆ 9/30",
            date: "2025-09-30",
            in_target_month: false
          },
          {
            key: "tue",
            label: "ç« 10/1",
            date: "2025-10-01",
            in_target_month: true
          }
          # ... ä»–ã®æ—¥
        ]
      }
      # ... ä»–ã®é€±
    ]
  end

  def load_existing_shifts(year, month)
    # æ—¢å­˜ã®ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    # TODO: å®Ÿè£…è©³ç´°
    {}
  end

  def save_shifts_as_draft(year, month, shifts_data)
    # ä¸‹æ›¸ãä¿å­˜å‡¦ç†
    # TODO: å®Ÿè£…è©³ç´°
  end

  def submit_shifts(year, month, shifts_data)
    # æœ€çµ‚æå‡ºå‡¦ç†
    # TODO: å®Ÿè£…è©³ç´°
  end

  def validate_shifts(shifts_data)
    # åŠ´åƒæ™‚é–“åˆ¶é™æ¤œè¨¼
    results = []

    shifts_data.each do |week_key, week_data|
      week_id = week_key.gsub('week_', '').to_i

      company_hours = calculate_weekly_hours(week_data['company'])
      sidejob_hours = calculate_weekly_hours(week_data['sidejob'])
      total_hours = company_hours + sidejob_hours

      violations = []
      violations << {
        type: 'company_hours_exceeded',
        limit: 20,
        actual: company_hours,
        message: 'å¼Šç¤¾ã§ã®é€±20æ™‚é–“åˆ¶é™ã‚’è¶…é'
      } if company_hours > 20

      violations << {
        type: 'total_hours_exceeded',
        limit: 40,
        actual: total_hours,
        message: 'é€±40æ™‚é–“åˆ¶é™ã‚’è¶…éï¼ˆå¼Šç¤¾+æ›ã‘æŒã¡ï¼‰'
      } if total_hours > 40

      results << {
        week_id: week_id,
        week_title: "ç¬¬#{week_id}é€±", # TODO: å®Ÿéš›ã®ã‚¿ã‚¤ãƒˆãƒ«
        company_hours: company_hours,
        sidejob_hours: sidejob_hours,
        total_hours: total_hours,
        violations: violations
      }
    end

    results
  end

  def calculate_weekly_hours(shift_times)
    return 0 unless shift_times

    total_hours = 0
    %w[mon tue wed thu fri sat sun].each do |day|
      start_time = shift_times['start']&.[](day)
      end_time = shift_times['end']&.[](day)

      next unless start_time.present? && end_time.present?

      start_minutes = time_to_minutes(start_time)
      end_minutes = time_to_minutes(end_time)

      working_minutes = end_minutes - start_minutes
      working_minutes -= 60 if working_minutes >= 360 # 6æ™‚é–“ä»¥ä¸Šã¯1æ™‚é–“ä¼‘æ†©

      total_hours += working_minutes / 60.0
    end

    total_hours.round(1)
  end

  def time_to_minutes(time_str)
    hour, minute = time_str.split(':').map(&:to_i)
    hour * 60 + minute
  end

  def editable_month?(year, month)
    target_date = Date.new(year, month, 1)
    target_date > Date.current.beginning_of_month
  end
end
```

#### 3.2 ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ 

```ruby
# config/routes.rb ã«è¿½åŠ 
namespace :api do
  resources :shift_requests, only: [] do
    collection do
      get :weeks
      get :existing
      post :save_draft
      post :submit
      post :validate
    end
  end
end
```

### 4. Vue.jsã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ APIé€£æº

#### 4.1 APIå‘¼ã³å‡ºã—é–¢æ•°

```javascript
// frontend/services/ShiftRequestAPI.js
export class ShiftRequestAPI {
  static async getWeeks(year, month) {
    const response = await fetch(`/api/shift_requests/weeks?year=${year}&month=${month}`)
    return response.json()
  }

  static async getExistingShifts(year, month) {
    const response = await fetch(`/api/shift_requests/existing?year=${year}&month=${month}`)
    return response.json()
  }

  static async saveDraft(year, month, shifts) {
    const response = await fetch('/api/shift_requests/save_draft', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
      },
      body: JSON.stringify({ year, month, shifts })
    })
    return response.json()
  }

  static async submitShifts(year, month, shifts) {
    const response = await fetch('/api/shift_requests/submit', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
      },
      body: JSON.stringify({ year, month, shifts })
    })
    return response.json()
  }

  static async validateShifts(weekShifts) {
    const response = await fetch('/api/shift_requests/validate', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
      },
      body: JSON.stringify({ week_shifts: weekShifts })
    })
    return response.json()
  }
}
```

#### 4.2 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¿®æ­£æ¡ˆ

```javascript
// frontend/components/ShiftRequestForm.vueå†…ã®setup()é–¢æ•°
export default {
  setup(props) {
    const weeks = ref([])
    const isLoading = ref(true)
    const errorMessage = ref('')

    // APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
    const loadWeeksData = async () => {
      try {
        isLoading.value = true

        // é€±ãƒ‡ãƒ¼ã‚¿ã¨existingShiftsã‚’ä¸¦è¡Œå–å¾—
        const [weeksResponse, existingResponse] = await Promise.all([
          ShiftRequestAPI.getWeeks(props.targetYear, props.targetMonth),
          ShiftRequestAPI.getExistingShifts(props.targetYear, props.targetMonth)
        ])

        if (weeksResponse.status === 'success') {
          weeks.value = weeksResponse.data.weeks.map(week => ({
            ...week,
            shifts: existingResponse.data.shifts[`week_${week.id}`] || createEmptyShifts()
          }))
        }
      } catch (error) {
        console.error('Failed to load shift data:', error)
        errorMessage.value = 'ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'
      } finally {
        isLoading.value = false
      }
    }

    // ä¸‹æ›¸ãä¿å­˜
    const saveShifts = async () => {
      try {
        const shiftsData = convertWeeksToAPIFormat(weeks.value)
        const response = await ShiftRequestAPI.saveDraft(
          props.targetYear,
          props.targetMonth,
          shiftsData
        )

        if (response.status === 'success') {
          alert('ä¸‹æ›¸ãã‚’ä¿å­˜ã—ã¾ã—ãŸ')
          // æ¤œè¨¼çµæœãŒã‚ã‚Œã°è¡¨ç¤º
          if (response.data.validation_results?.length > 0) {
            displayValidationResults(response.data.validation_results)
          }
        }
      } catch (error) {
        console.error('Save failed:', error)
        alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ')
      }
    }

    // æœ€çµ‚æå‡º
    const submitShifts = async () => {
      try {
        const shiftsData = convertWeeksToAPIFormat(weeks.value)
        const response = await ShiftRequestAPI.submitShifts(
          props.targetYear,
          props.targetMonth,
          shiftsData
        )

        if (response.status === 'success') {
          alert('ã‚·ãƒ•ãƒˆã‚’æå‡ºã—ã¾ã—ãŸ')
          // æå‡ºå¾Œã¯ãƒšãƒ¼ã‚¸é·ç§»ç­‰
          window.location.href = '/shift_requests'
        } else if (response.status === 'violation_error') {
          errorMessage.value = response.message
          displayViolationErrors(response.errors)
        }
      } catch (error) {
        console.error('Submit failed:', error)
        alert('æå‡ºã«å¤±æ•—ã—ã¾ã—ãŸ')
      }
    }

    onMounted(() => {
      loadWeeksData()
    })

    return {
      weeks,
      isLoading,
      errorMessage,
      saveShifts,
      submitShifts
      // ...
    }
  }
}
```

### 5. å®Ÿè£…æ‰‹é †

1. **APIã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ä½œæˆ**
   - `Api::ShiftRequestsController` ã®ä½œæˆ
   - åŸºæœ¬çš„ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…

2. **Vue.js APIé€£æº**
   - APIå‘¼ã³å‡ºã—ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ä½œæˆ
   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’APIå‘¼ã³å‡ºã—ã«å¤‰æ›´

3. **ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–**
   - æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã§ã®ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ä¿å­˜
   - ä¸‹æ›¸ããƒ»æå‡ºçŠ¶æ…‹ç®¡ç†

4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
   - APIé€šä¿¡ã‚¨ãƒ©ãƒ¼å¯¾å¿œ
   - åˆ¶é™é•åã‚¨ãƒ©ãƒ¼è¡¨ç¤º

5. **ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼**
   - APIå‹•ä½œç¢ºèª
   - Vue.jsé€£æºãƒ†ã‚¹ãƒˆ
   - åˆ¶é™ãƒã‚§ãƒƒã‚¯æ¤œè¨¼
