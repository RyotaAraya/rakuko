# 労働時間計算仕様書

## 基本ルール

### 1. 学生アルバイトの労働制限
- **週20時間制限**：実労働時間が週20時間以下
- **掛け持ち制限**：他バイトとの合計実労働時間が週40時間以下
- **実労働時間** = 勤務時間 - 休憩時間（6時間以上勤務時は1時間休憩を自動差し引き）

### 2. シフト提出時のルール
- **入力項目**：始業時間と終業時間のみ
- **休憩時間は入力しない**（面倒なため）
- **6時間以上勤務**：システムが自動で1時間休憩を差し引いて実労働時間を計算
- **6時間未満勤務**：休憩なしとして実労働時間 = 勤務時間

### 3. 勤怠登録時のルール
- **出勤・退勤・休憩開始/終了**：ボタンでリアルタイム記録
- **複数回休憩可能**：累計休憩時間で計算
- **休憩記録忘れ**：手動入力も可能
- **実労働時間** = 出勤〜退勤時間 - 累計休憩時間

## シフト提出時の計算例

### ケース1：7時間勤務 × 3日
```
入力：
月曜: 9:00-16:00 (7時間勤務)
水曜: 9:00-16:00 (7時間勤務)
金曜: 9:00-16:00 (7時間勤務)

システム計算：
月曜: 7時間 - 1時間(自動休憩) = 6時間実労働
水曜: 7時間 - 1時間(自動休憩) = 6時間実労働
金曜: 7時間 - 1時間(自動休憩) = 6時間実労働
週合計: 18時間実労働 ✓ (20時間以下)
```

### ケース2：8時間勤務 × 3日
```
入力：
月曜: 9:00-17:00 (8時間勤務)
水曜: 9:00-17:00 (8時間勤務)
金曜: 9:00-17:00 (8時間勤務)

システム計算：
月曜: 8時間 - 1時間(自動休憩) = 7時間実労働
水曜: 8時間 - 1時間(自動休憩) = 7時間実労働
金曜: 8時間 - 1時間(自動休憩) = 7時間実労働
週合計: 21時間実労働 ❌ (20時間超過)
```

### ケース3：短時間勤務
```
入力：
月曜: 9:00-14:00 (5時間勤務)
水曜: 9:00-15:00 (6時間勤務)
金曜: 9:00-13:00 (4時間勤務)

システム計算：
月曜: 5時間実労働 (6時間未満なので休憩差し引きなし)
水曜: 6時間 - 1時間(自動休憩) = 5時間実労働
金曜: 4時間実労働 (6時間未満なので休憩差し引きなし)
週合計: 14時間実労働 ✓
```

## 勤怠登録時の計算例

### ケース1：予定通り勤務
```
シフト予定: 9:00-16:00 (予定実労働6時間)
実際勤怠:
- 出勤: 9:00
- 休憩: 12:00-13:00 (1時間)
- 退勤: 16:00
実労働時間: 7時間 - 1時間 = 6時間 ✓
```

### ケース2：複数回休憩
```
シフト予定: 9:00-17:00 (予定実労働7時間)
実際勤怠:
- 出勤: 9:00
- 休憩1: 12:00-12:30 (30分)
- 休憩2: 15:00-15:45 (45分)
- 退勤: 17:00
実労働時間: 8時間 - 1時間15分 = 6時間45分
```

## システムチェック項目

### シフト提出時
- [ ] 勤務時間6時間以上の場合、自動で1時間休憩を差し引き
- [ ] 週合計実労働時間が20時間以下かチェック
- [ ] 掛け持ちバイトとの合計が40時間以下かチェック
- [ ] 制限超過時は提出ボタン無効化

### 勤怠登録時
- [ ] 出勤〜退勤時間から累計休憩時間を差し引いて実労働時間計算
- [ ] 実績労働時間をリアルタイム更新
- [ ] 残りシフト予定時間 + 実績労働時間で週20時間超過予測
- [ ] 超過予測時は事前警告表示
- [ ] 実際に20時間超過時は重要警告表示

## 週労働時間予測ロジック

### 計算式
```
今週の予測労働時間 = 実績労働時間 + 残りシフト予定時間

実績労働時間 = すでに勤務完了した日の実労働時間の合計
残りシフト予定時間 = まだ勤務していない日のシフト予定実労働時間の合計
```

### 予測例
```
【今週のシフト予定】
月曜: 9:00-16:00 → 予定実労働6時間
水曜: 9:00-16:00 → 予定実労働6時間
金曜: 9:00-16:00 → 予定実労働6時間
週予定合計: 18時間

【水曜日の勤怠登録中】
月曜実績: 6.5時間 (実際に勤務完了)
水曜現在: 3時間 (勤務中、まだ完了していない)
金曜予定: 6時間 (未勤務)

予測労働時間 = 6.5時間(月曜実績) + 6時間(金曜予定) + 水曜の最終予測時間
→ 水曜が7時間になりそうなら 6.5 + 7 + 6 = 19.5時間
→ 水曜が8時間になりそうなら 6.5 + 8 + 6 = 20.5時間 ⚠️超過予測
```

## 月末締め作業管理

### 外部ツール連携仕様
- **ジョブカン**：交通費申請
- **ラクロー**：勤怠締め作業
- 本アプリは各ツールでの作業完了確認のみを管理

### 月末締め作業フロー
1. **学生の作業**
   - ジョブカンで交通費申請を完了
   - ラクローで勤怠締め作業を完了
   - 本アプリで完了チェックを入力

2. **部署担当者の確認**
   - 学生の完了チェック状況を確認
   - ジョブカン・ラクローで実際の作業状況を目視確認
   - 本アプリで承認処理

3. **労務担当者の最終確認**
   - 部署担当者の承認状況を確認
   - ジョブカン・ラクローで最終確認
   - 本アプリで最終承認

### チェック項目
- **ジョブカン交通費申請完了**：チェックボックス
- **ラクロー締め完了**：チェックボックス
- **外部ツールリンク**：各ツールへの直接リンク表示

### リマインド機能
- **表示タイミング**：常時表示（ダッシュボード）
- **必須入力日**：毎月最終出社日
- **リマインド方法**：Slack通知
- **対象者**：未完了の学生、未承認の管理者
- **締切後処理**：過ぎてもやむなし（記録は残す）

### 承認フロー
```
学生チェック → 部署担当者承認 → 労務担当者最終承認
   ↓              ↓                ↓
外部ツール確認  外部ツール目視確認  外部ツール最終確認
```

## 画面表示形式

### 月末締め作業画面
```
【今月の締め作業】2024年3月
締切日: 3月29日（最終出社日）

□ ジョブカン交通費申請完了 [ジョブカンを開く]
□ ラクロー締め完了 [ラクローを開く]

[完了報告] ← 両方チェック後に有効化

ステータス: 未完了
部署承認: 待機中
労務承認: 待機中
```

### シフト希望画面
```
【今週のシフト希望】
月曜: 9:00-16:00 → 実労働6時間 (7時間勤務-1時間休憩)
水曜: 9:00-16:00 → 実労働6時間 (7時間勤務-1時間休憩)
金曜: 9:00-16:00 → 実労働6時間 (7時間勤務-1時間休憩)

週予定実労働時間: 18時間 / 20時間 ✓
掛け持ちバイト: 15時間
総合計実労働時間: 33時間 / 40時間 ✓
```

### 勤怠登録画面（勤務中）
```
【今日の勤怠】
出勤: 09:00 (3時間経過)
休憩: 12:00-13:00 (1時間)
現在実労働時間: 2時間

【今週の状況】
実績労働時間: 12.5時間 (月6.5h + 火6h + 今日2h)
残り予定時間: 6時間 (金曜予定)
予測合計: 18.5時間 / 20時間

⚠️ 今日8時間勤務なら週20.5時間となり制限超過予定
```

### 勤怠登録画面（完了後）
```
【今日の勤怠】
出勤: 09:00
休憩: 12:00-13:00 (1時間)
退勤: 16:00
実労働時間: 6時間

【今週の累計】
実績労働時間: 18時間 / 20時間 ✓
残り予定時間: 6時間 (金曜)
予測合計: 24時間 ❌ 制限超過予定！
```